<!DOCTYPE html>
<html lang="en"><head>
<script src="slides_files/libs/clipboard/clipboard.min.js"></script>
<script src="slides_files/libs/quarto-html/tabby.min.js"></script>
<script src="slides_files/libs/quarto-html/popper.min.js"></script>
<script src="slides_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="slides_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="slides_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="slides_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.2.335">

  <meta name="author" content="Stephen Vaisey">
  <title>Multilevel and Mixed Models Using Stata</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="slides_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="slides_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="slides_files/libs/revealjs/dist/theme/quarto.css" id="theme">
  <link href="slides_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="slides_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="slides_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="slides_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-captioned.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-captioned) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-captioned.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-captioned .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-captioned .callout-caption  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-captioned.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-captioned.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-caption {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-caption {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-caption {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-captioned .callout-body > .callout-content > :last-child {
    margin-bottom: 0.5rem;
  }

  .callout.callout-captioned .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-captioned) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-caption {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-caption {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-caption {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-caption {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-caption {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
  <script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Multilevel and Mixed Models Using Stata</h1>
  <p class="subtitle">Version 11</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Stephen Vaisey 
</div>
</div>
</div>

</section>
<section>
<section id="the-big-picture" class="title-slide slide level1 center">
<h1>The Big Picture</h1>

</section>
<section id="what-is-variance" class="slide level2">
<h2>What is variance?</h2>
<div class="cell" data-execution_count="1">
<div class="cell-output cell-output-display">
<style>div.jp-Notebook .datagrid-container {min-height: 448px; }</style>
</div>
</div>
<p><span class="math display">\[
    \frac{1}{N-1} \sum_{i=1}^{N}(y_i - \bar{y})^2
\]</span></p>
<p>What is the variance of the following “dataset”?: 1, 2, 3, 4, 5</p>
<p>Because 3 is the mean, we take the square of the difference between each element and 3, then add them up, then multiply by <span class="math inline">\(\frac{1}{4}\)</span>. So the answer is <span class="math inline">\((-2^2 + -1^2 + 0^2 + 1^2 + 2^2) \times \frac{1}{4} = 2.5.\)</span></p>
</section>
<section id="quantifying-the-mystery" class="slide level2">
<h2>Quantifying the mystery</h2>
<p>The most important part of variance is the part on the right: <span class="math inline">\(\sum(y_i - \bar{y})^2\)</span>. This is the sum of squared deviations between each observation of <span class="math inline">\(Y\)</span> and the mean of <span class="math inline">\(Y\)</span>. You probably know that already. But think about it: this number quantifies the mystery we’re trying to solve. The bigger it is, the more uncertain we are about the location of any individual observation.</p>
</section>
<section id="residual-variance" class="slide level2">
<h2>Residual variance</h2>
<p><span class="math display">\[\frac{1}{N-1}\sum_{i=1}^{n}(y_i - \hat{y}_i)^2\]</span></p>
<p>where</p>
<p><span class="math display">\[\hat{y}_i=E(Y \mid X=x ) \]</span></p>
<p>In “normal” (i.e., single-level) data, our tools for reducing variance (i.e., making observations more “predictable”) involve making <span class="math inline">\(Y\)</span> a function of other variables in a linear regression. As we add predictors, we get a <em>residual variance</em> that is smaller than the original variance.</p>
</section>
<section id="variance-explained" class="slide level2">
<h2>Variance “explained”</h2>
<p><span class="math display">\[ R^2 = 1 - \frac{\sum(y_i - \hat{y}_i)^2}{\sum(y_i - \bar{y})^2} \]</span></p>
<p>The numerator is the sum of squared deviations from the <em>predictions</em> (from a regression model).</p>
<p>The denominator is the sum of squared deviations from the <em>mean</em>.</p>
</section></section>
<section>
<section id="distinguishing-within-and-between-variability" class="title-slide slide level1 center">
<h1>Distinguishing <em>within</em> and <em>between</em> variability</h1>

</section>
<section id="two-typical-situations" class="slide level2">
<h2>Two typical situations</h2>
<h3 id="clusters">Clusters</h3>
<ul>
<li>e.g., a sample of 10 students each from 30 different classrooms</li>
<li>students “nested in” classrooms</li>
<li><span class="math inline">\(N_1 = 300\)</span>, <span class="math inline">\(N_2 = 30\)</span></li>
</ul>
<h3 id="repeated-observations">Repeated observations</h3>
<ul>
<li>e.g., 100 college first-years surveyed in fall, then spring, then summer</li>
<li>observations “nested in” individuals</li>
<li><span class="math inline">\(N_1 = 300\)</span>, <span class="math inline">\(N_2 = 100\)</span></li>
</ul>
</section>
<section id="clustered-data" class="slide level2">
<h2>Clustered data</h2>

<img data-src="images/heights.svg" class="r-stretch quarto-figure-center"><ul>
<li>“Alyssa is the tallest student in her class” (within)</li>
<li>“Mr.&nbsp;Jones’s students are taller than Ms.&nbsp;Smith’s students” (between)</li>
</ul>
</section>
<section id="repeated-measures-data" class="slide level2">
<h2>Repeated measures data</h2>

<img data-src="images/depression.svg" class="r-stretch quarto-figure-center"><ul>
<li>“Cassidy was more depressed in year 3 than usual” (within)</li>
<li>“Hannah is typically less depressed than Cassidy” (between)</li>
</ul>
</section>
<section id="quantifying-within-and-between" class="slide level2">
<h2>Quantifying within and between</h2>
<p>Intraclass correlation (ICC)</p>
<p><span class="math display">\[ICC = \frac{\text{Between-group variance}}{\text{Total variance}} \]</span></p>
<p>Or, written more formally:</p>
<p><span class="math display">\[\rho = \frac{\tau^2}{\tau^2+\sigma^2} \]</span></p>
<p>Conventions vary by field, but <span class="math inline">\(\tau^2\)</span> is typically used for between-group variance and <span class="math inline">\(\sigma^2\)</span> is used for within-group variance.</p>
</section>
<section id="icc-of-heights" class="slide level2 bigger">
<h2>ICC of heights</h2>
<p>Calculating manually using <code>mata</code>:</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span>: total_var = <span class="kw">variance</span>(36\37\38\39\40\ 46\47\48\49\50)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span>: between_var = <span class="kw">variance</span>(38\38\38\38\38\ 48\48\48\48\48)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span>: between_var / total_var</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  .9259259259</code></pre>
</div>
</div>
<p>About 93% of the variance is between groups.</p>
</section>
<section id="icc-of-depression" class="slide level2 bigger">
<h2>ICC of depression</h2>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span>: total_var = <span class="kw">variance</span>(12\14\10\ 15\12\18)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span>: between_var = <span class="kw">variance</span>(12\12\12\ 15\15\15)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span>: between_var / total_var</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  .3417721519</code></pre>
</div>
</div>
<p>About 34% of the variance is between subjects.</p>
</section></section>
<section>
<section id="to-pool-or-not-to-pool-combining-variance-in-one-dimension" class="title-slide slide level1 center">
<h1>To Pool or Not to Pool: Combining Variance in One Dimension</h1>

</section>
<section id="simulated-data-on-student-study-hours" class="slide level2">
<h2>Simulated data on student study hours</h2>

<img data-src="images/simschools.svg" class="r-stretch quarto-figure-center"></section>
<section id="descriptive-statistics" class="slide level2">
<h2>Descriptive statistics</h2>
<div class="cell" data-execution_count="4">
<div class="cell-output cell-output-stdout">
<pre><code>
                            hours
-------------------------------------------------------------
      Percentiles      Smallest
 1%     3.713705       2.020956
 5%     5.160595       2.639034
10%     6.061595       2.925808       Obs                 900
25%     7.458902       3.128079       Sum of wgt.         900

50%            9                      Mean                  9
                        Largest       Std. dev.      2.295111
75%      10.5411       14.87192
90%     11.93841       15.07419       Variance       5.267533
95%     12.83941       15.36097       Skewness      -5.44e-16
99%      14.2863       15.97904       Kurtosis       2.879453</code></pre>
</div>
</div>
<p>The variance here is the <em>total</em> amount of variance.</p>
</section>
<section id="decomposing-variance" class="slide level2">
<h2>Decomposing variance</h2>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>  <span class="co">// the oneway (ANOVA) command is a handy calculator of squared deviations</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="kw">oneway</span> hours school_id</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
                        Analysis of variance
    Source              SS         df      MS            F     Prob &gt; F
------------------------------------------------------------------------
Between groups      947.102456     29   32.6587054      7.50     0.0000
 Within groups      3788.40982    870   4.35449405
------------------------------------------------------------------------
    Total           4735.51228    899   5.26753313

Bartlett's equal-variances test: chi2(29) =   0.0000    Prob&gt;chi2 = 1.000</code></pre>
</div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>  <span class="co">// we use items from the oneway return list to calculate the ICC/VPC</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="kw">di</span> <span class="ot">`r(mss)'</span> / (<span class="ot">`r(mss)'</span> + <span class="ot">`r(rss)'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>.2</code></pre>
</div>
</div>
<p>About 20% of the variance is at the school level.</p>
</section>
<section id="making-predictions-about-new-units" class="slide level2">
<h2>Making predictions about new units</h2>
<h3 id="assume-two-new-schools-with-little-data">Assume two “new” schools with little data</h3>
<ul>
<li><strong>School 31:</strong> 2 students; 2 and 4 hours</li>
<li><strong>School 32:</strong> 2 students; 14 and 16 hours</li>
</ul>
<p>What’s the right way to make good inferences about these schools?</p>
<h3 id="three-approaches">Three approaches</h3>
<ul>
<li>No pooling</li>
<li>Partial pooling</li>
<li>Complete pooling</li>
</ul>
</section>
<section id="no-pooling" class="slide level2">
<h2>No pooling</h2>
<p>If we decide to estimate, say, school 32’s average without pooling, that means that we cannot consider <em>any other information except data from school 32.</em> That’s what no pooling means – we are not allowed to use information from any other cluster to make inferences about <em>this</em> cluster. So even if we might be skeptical about making inferences from just two data points, our best guess of the school average would be 15 hours <span class="math inline">\(((14+16) / 2 = 15)\)</span>).</p>
</section>
<section id="partial-pooling-and-shrinkage" class="slide level2">
<h2>Partial pooling and shrinkage</h2>
<ul>
<li>We combine cluster-specific data (e.g., new schools’ means of 3 and 15) with data about the distribution of clusters (e.g., the distribution of schools’ means has a mean of 9.00 and a SD of 1.09).</li>
<li>This is sometimes called an “empirical Bayes” estimate.</li>
<li>We combine the entire distribution (the “prior”) with the specific data from one cluster to create a “posterior” estimate of that cluster’s “true” mean.</li>
<li>This “shrinks” the simple value toward the mean of all clusters.</li>
</ul>
</section>
<section id="formulas" class="slide level2">
<h2>Formulas</h2>
<ul>
<li><span class="math inline">\(\hat{\mu}_j^{PP}\)</span> is the “partial pooling” estimate of the mean of cluster <span class="math inline">\(j\)</span>.</li>
<li><span class="math inline">\(\hat{\mu}_j^{ML}\)</span> is the “maximum likelihood” estimate of the mean for cluster <span class="math inline">\(j\)</span>. This is just the ordinary average.</li>
<li><span class="math inline">\(\bar{\mu}\)</span> is the mean of means for all the clusters (here 9 hours).</li>
<li><span class="math inline">\(\tau^2\)</span> is the between-group variance.</li>
<li><span class="math inline">\(\sigma^2\)</span> is the within-group variance (total variance <span class="math inline">\(-\)</span> <span class="math inline">\(\tau^2\)</span>).</li>
<li><span class="math inline">\(n_j\)</span> is the number of respondents (i.e., data points) in cluster <span class="math inline">\(j\)</span>.</li>
<li><span class="math inline">\(\hat{R}_j\)</span> is the “shrinkage factor” for cluster <span class="math inline">\(j\)</span>; that is, how much we “shrink” the extremity of the cluster’s maximum likelihood estimate. It will always be somewhere between 0 and 1.</li>
</ul>
</section>
<section id="putting-all-the-pieces-together" class="slide level2">
<h2>Putting all the pieces together</h2>
<p><span class="math display">\[ \hat{\mu}_j^{PP} = \hat{R}_j(\hat{\mu}_j^{ML} - \bar{\mu}) + \bar{\mu} \]</span></p>
<p>Where</p>
<p><span class="math display">\[ \hat{R}_j = \frac{\tau^2}{\tau^2 + \sigma^2 / n_j} \]</span></p>
</section>
<section id="estimating-the-eb-mean-for-school-32" class="slide level2">
<h2>Estimating the EB mean for school 32</h2>
<p>Start with…</p>
<p><span class="math display">\[\hat{\mu}_{32}^{PP} = \hat{R}_{32}(\hat{\mu}_{32}^{ML} - \bar{\mu}) + \bar{\mu}\]</span></p>
<p>Plug in values…</p>
<p><span class="math display">\[\hat{\mu}_{32}^{PP} = \hat{R}_{32}(15 - 9) + 9\]</span></p>
<p>All that’s missing is the shrinkage factor, <span class="math inline">\(\hat{R}_{32}\)</span>.</p>
</section>
<section id="estimating-the-shrinkage-factor" class="slide level2">
<h2>Estimating the shrinkage factor</h2>
<p>We just need a few ingredients: the total variance of the new dataset (5.41) and the between variance of the new dataset (1.21).</p>
<p>We already know that <span class="math inline">\(n_{32} = 2\)</span>. So let’s plug everything in:</p>
<p><span class="math display">\[\hat{R}_{32} = \frac{1.21}{1.21 + 4.21 / 2 } = .365 \]</span></p>
</section>
<section id="putting-all-the-pieces-together-1" class="slide level2">
<h2>Putting all the pieces together</h2>
<p><span class="math display">\[\hat{\mu}_{32}^{PP} = .365(15 - 9) + 9 = 11.19\]</span></p>
<p>Our best guess of the mean study time per week in school 32 is not 15 hours, but a bit over 11 hours.</p>
<p>Why? If our 32 schools are a <em>sample</em> then we can use the distribution of school means to assess the plausibility of any particular school-specific estimate.</p>
<p>School 32’s mean is way outside the norm for that population and is based on a tiny amount of data. So we’re better off not taking its average “too literally.”</p>
<p>Two students report such high numbers (14 and 16 hours) suggests that the school is likely above average; but it’s not enough data to fully overcome the “prior” distribution of school means.</p>
</section>
<section id="what-would-affect-the-shrinkage-factor" class="slide level2">
<h2>What would affect the shrinkage factor?</h2>
<p>As <span class="math inline">\(n_j \rightarrow \infty\)</span>, <span class="math inline">\(R \rightarrow 1\)</span></p>
<p>The more data we have on a cluster, the more we can rely on its data alone to provide an accurate estimate.</p>
<p>As <span class="math inline">\(ICC \rightarrow 1\)</span>, <span class="math inline">\(R \rightarrow 1\)</span></p>
<p>The more homogeneous the clusters, the less data we need from each cluster to get an accurate estimate of its central tendency.</p>
</section>
<section id="shrinkage-applies-to-all-clusters" class="slide level2">
<h2>Shrinkage applies to all clusters</h2>
<p>The number we got for school 32 is close but not <em>exactly</em> the number we would get from doing this with the computer.</p>
<p>This is because the between-group variance gets calculated with shrinkage for <em>every</em> school simultaneously, not just for a single “new” cluster.</p>
<p>There are 30 students each in schools 1 through 30. This is a decent sample size per school, but we might not take deviations from the mean <em>literally</em> because smaller samples will likely have greater variance by chance alone.</p>
</section>
<section id="more-intuition" class="slide level2">
<h2>More intuition</h2>
<p>Partial pooling might seem strange, but we do it all the time. Consider baseball. If a player you’ve never seen before gets a hit on his first at bat, what’s your best estimate of his lifetime batting average? It’s not 100%! This is because you naturally combine data about <em>the population</em> of professional baseball players with the new data from this player.</p>
<p>It’s the same idea if you see someone run a red light in their car. You probably won’t infer that this person <em>always</em> runs red lights because you unconsciously combine that one data point with your knowledge of the population of drivers. You might think a person who runs a red light is a bit riskier of a driver than average, but it would take more data to be sure the person qualifies as a truly “reckless driver.”</p>
<p>This caveat is not at all important for understanding the gist of how shrinkage is done, but it will affect the exact calculations.</p>
</section>
<section id="partial-pooling-is-the-foundation-of-mlms" class="slide level2">
<h2>Partial pooling is the foundation of MLMs</h2>
<p>It may not be obvious quite yet, but partial pooling is what makes models into <em>multilevel</em> models. Sometimes models that incorporate at least some shrinkage are called “random effects” or “mixed” models. We’ll go over what all that means soon. For now, it will be helpful if you spend the time you need to get the gist of what’s happening in one dimension. That will make later sections easier to grasp.</p>
</section>
<section id="complete-pooling" class="slide level2">
<h2>Complete pooling</h2>
<p>Complete pooling assumes that there are no real differences in means between clusters. In practice, this means ignoring the multilevel structure of the data and acting as if we have “pooled” one-level data. This gets more interesting (and useful) when we’re dealing with multivariate data rather than with a single variable.</p>
<p>Even though it’s not very useful yet, we can still use the one-variable case to build intuition. What does complete pooling imply about groups? Consider the students in schools example. If we assume that there are no systematic differences between schools, then every school (given a big enough sample size) would converge to the same mean. This means that if we wanted to make a prediction about a new school, our best bet is just to select the mean of all <em>individuals</em> in the sample. This means that our best guess of the “true” mean of all the schools would be 9.0. Given the way we constructed the data, this is clearly not true!</p>
</section>
<section id="section" class="slide level2">
<h2></h2>
<h4 id="no-pooling-1">No pooling</h4>
<p><span class="math inline">\(y_{ij} = \mu + \alpha_{j} + \epsilon_{ij}\)</span>, where <span class="math inline">\(\mu\)</span> is the mean of the reference category and <span class="math inline">\(\alpha_j\)</span> is a set of <span class="math inline">\(J-1\)</span> fixed dummy variables.</p>
<p><span class="math inline">\(\epsilon_{ij} \sim N(0,\sigma^2)\)</span></p>
<h4 id="partial-pooling">Partial pooling</h4>
<p><span class="math inline">\(y_{ij} = \mu + \alpha_{j} + \epsilon_{ij}\)</span></p>
<p><span class="math inline">\(\alpha_j \sim N(0,\tau^2)\)</span>, where <span class="math inline">\(\mu\)</span> is the average cluster mean</p>
<p><span class="math inline">\(\epsilon_{ij} \sim N(0,\sigma^2)\)</span></p>
<h4 id="complete-pooling-1">Complete pooling</h4>
<p><span class="math inline">\(y_{ij} = \mu + \alpha_{j} + \epsilon_{ij}\)</span></p>
<p><span class="math inline">\(\alpha_j \sim N(0,0) \qquad\)</span> [assumes <span class="math inline">\(\alpha_j\)</span> does not vary]</p>
<p><span class="math inline">\(\epsilon_{ij} \sim N(0,\sigma^2)\)</span></p>
</section>
<section id="random-and-fixed-effects" class="slide level2">
<h2>“Random” and “fixed” effects</h2>
<ul>
<li>Although this terminology can be confusing, we generally speak of <em>random effects</em> when estimates combine within- and between-cluster variance (partial pooling) and <em>fixed effects</em> when estimates use only within-cluster data (no pooling).</li>
<li>We will talk more about this later on when we start building multivariate models, but this is a big part of the difference.</li>
<li>In general, I strongly prefer the language of pooling because it is much clearer.</li>
</ul>
</section>
<section id="section-1" class="slide level2">
<h2></h2>
<h3 id="no-pooling-2">No pooling</h3>
<p><code>regress hours i.school_id</code></p>
<p>Because we are not combining information across levels, we can simply use <code>regress</code> here with dummies for schools.</p>
<h3 id="partial-pooling-1">Partial pooling</h3>
<p><code>mixed hours || school_id:</code></p>
<p>We will use <code>mixed</code> to estimate models with partial pooling.</p>
<h3 id="complete-pooling-2">Complete pooling</h3>
<p><code>regress hours</code></p>
<p>Because complete pooling assumes no variance by cluster, we can just use <code>regress</code> to estimate the overall sample mean and variance.</p>
</section>
<section id="the-school-data" class="slide level2">
<h2>The school data</h2>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>mixed hours || school_id: , <span class="kw">noheader</span> <span class="kw">nolog</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>------------------------------------------------------------------------------</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>       hours | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>-------------+----------------------------------------------------------------</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>       _cons |</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>          9   .1872909    48.05   0.000     8.632917    9.367083</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>------------------------------------------------------------------------------</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
------------------------------------------------------------------------------
  Random-effects parameters  |   Estimate   Std. err.     [95% conf. interval]
-----------------------------+------------------------------------------------
school_id: Identity          |
                  var(_cons) |   .9071862   .2718011      .5042766    1.632015
-----------------------------+------------------------------------------------
               var(Residual) |   4.354494    .208782      3.963928    4.783543
------------------------------------------------------------------------------
LR test vs. linear model: chibar2(01) = 110.89        Prob &gt;= chibar2 = 0.0000</code></pre>
</div>
</div>
</section>
<section id="calculating-icc" class="slide level2">
<h2>Calculating ICC</h2>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">estat</span> icc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Intraclass correlation
</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>------------------------------------------------------------------------------
                       Level |        ICC   Std. err.     [95% conf. interval]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>-----------------------------+------------------------------------------------</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                   school_id |   .1724138    .043467      .1028749    .2745716</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>------------------------------------------------------------------------------</code></pre>
</div>
</div>
</section></section>
<section>
<section id="working-example" class="title-slide slide level1 center">
<h1>Working Example</h1>

</section>
<section id="data" class="slide level2">
<h2>Data</h2>
<ul>
<li>2014 European Social Survey</li>
<li>29 countries</li>
<li><strong>Outcome:</strong> All things considered, how satisfied are you with your life as a whole nowadays? Please answer using this card, where 0 means extremely dissatisfied and 10 means extremely satisfied.</li>
</ul>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="kw">data</span>/ess5000_imp.dta, <span class="kw">clear</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> country                    <span class="co">// drop numeric</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="kw">encode</span> cntry, <span class="kw">gen</span>(country)      <span class="co">// numeric with labels</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>snapshot erase <span class="dt">_all</span>             <span class="co">// just in case</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>snapshot <span class="kw">save</span>                   <span class="co">// for easy recall of original data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>snapshot 1 created at 18 May 2023 21:59</code></pre>
</div>
</div>
</section>
<section id="countries-and-sample-sizes" class="slide level2">
<h2>Countries and sample sizes</h2>
<div class="cell" data-execution_count="10">
<div class="cell-output cell-output-stdout">
<pre><code>
    Country |      Freq.     Percent        Cum.
------------+-----------------------------------
         AL |         19        0.38        0.38
         BE |        112        2.24        2.62
         BG |         69        1.38        4.00
         CH |         68        1.36        5.36
         CY |          6        0.12        5.48
         CZ |         80        1.60        7.08
         DE |        675       13.50       20.58
         DK |         54        1.08       21.66
         EE |          8        0.16       21.82
         ES |        389        7.78       29.60
         FI |         47        0.94       30.54
         FR |        509       10.18       40.72
         GB |        466        9.32       50.04
         HU |         86        1.72       51.76
         IE |         38        0.76       52.52
         IL |         41        0.82       53.34
         IS |          5        0.10       53.44
         IT |        396        7.92       61.36
         LT |         23        0.46       61.82
         NL |        180        3.60       65.42
         NO |         44        0.88       66.30
         PL |        334        6.68       72.98
         PT |         72        1.44       74.42
         RU |        794       15.88       90.30
         SE |         83        1.66       91.96
         SI |         22        0.44       92.40
         SK |         40        0.80       93.20
         UA |        332        6.64       99.84
         XK |          8        0.16      100.00
------------+-----------------------------------
      Total |      5,000      100.00</code></pre>
</div>
</div>
</section>
<section id="distribution-of-the-outcome" class="slide level2">
<h2>Distribution of the outcome</h2>
<div class="cell" data-execution_count="11">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="kw">hist</span> stflife, <span class="kw">d</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(start=0, width=1)</code></pre>
</div>

</div>
<img data-src="slides_files/figure-revealjs/cell-12-output-2.svg" class="r-stretch"></section>
<section id="mean-and-variance-of-stflife" class="slide level2">
<h2>Mean and variance of <code>stflife</code></h2>
<div class="cell" data-execution_count="12">
<div class="cell-output cell-output-stdout">
<pre><code>
             How satisfied with life as a whole
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%            2              0
10%            3              0       Obs               5,000
25%            5              0       Sum of wgt.       5,000

50%            7                      Mean             6.7362
                        Largest       Std. dev.      2.340108
75%            8             10
90%            9             10       Variance       5.476105
95%           10             10       Skewness      -.8178173
99%           10             10       Kurtosis       3.293413</code></pre>
</div>
</div>
</section>
<section id="where-is-the-variance" class="slide level2">
<h2>Where is the variance?</h2>
<ul>
<li>The previous slide showed the <em>total</em> variance (5.5) in life satisfaction.</li>
<li>We can’t tell from that alone how much of the variance is within- vs.&nbsp;between-countries.</li>
<li>Imagine the two extreme alternatives. What would all within variance mean? What would all between variance mean?</li>
</ul>
</section>
<section id="quantifying-variability-with-the-icc" class="slide level2">
<h2>Quantifying variability with the ICC</h2>
<div class="cell" data-execution_count="13">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> mixed stflife || country:  <span class="co">// null or "empty" model</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="kw">estat</span> icc                      <span class="co">// ask for ICC (VPC)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Intraclass correlation

------------------------------------------------------------------------------
                       Level |        ICC   Std. err.     [95% conf. interval]
-----------------------------+------------------------------------------------</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                     country |   .1624107   .0392475      .0992241    .2544679
------------------------------------------------------------------------------</code></pre>
</div>
</div>
<p>About 16% of the variance in life satisfaction in Europe is between countries. The rest of the variance is within countries.</p>
</section>
<section id="np-and-pp-mean-estimates" class="slide level2">
<h2>NP and PP mean estimates</h2>
<div class="cell" data-execution_count="14">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="kw">quietly</span>{</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>        <span class="kw">predict</span> pp_mean, <span class="kw">fitted</span>             <span class="co">// partially pooled predictions</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">reg</span> stflife i.country               <span class="co">// simple means by cluster ("no pooling")</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">predict</span> np_mean                     <span class="co">// get predictions</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">contract</span> country pp_mean np_mean    <span class="co">// collapse so there are 29 rows</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="ot">list</span>, <span class="kw">clean</span> <span class="kw">noobs</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    country    pp_mean    np_mean   _freq  
         AL   5.757976   5.421052      19  
         BE    7.75963   7.794643     112  
         BG   5.044643   4.898551      69  
         CH   8.585573   8.705882      68  
         CY   7.089281   7.166667       6  
         CZ   6.389319       6.35      80  
         DE   7.599855   7.604445     675  
         DK   8.588921   8.740741      54  
         EE    6.69569        6.5       8  
         ES   6.969545   6.969151     389  
         FI    7.92022   8.021276      47  
         FR   6.350386   6.343812     509  
         GB   7.258929   7.261803     466  
         HU   6.067502   6.011628      86  
         IE   6.860884   6.842105      38  
         IL   7.454883   7.512195      41  
         IS   7.393426        7.8       5  
         IT   6.665956   6.661616     396  
         LT   7.035377   7.043478      23  
         NL   7.718287   7.738889     180  
         NO   8.159466   8.295455      44  
         PL   6.955761    6.95509     334  
         PT   6.092711   6.027778      72  
         RU   5.756185   5.748111     794  
         SE   7.850708   7.903615      83  
         SI   7.552197   7.681818      22  
         SK   6.867045       6.85      40  
         UA   5.158118   5.129518     332  
         XK   7.379725      7.625       8  </code></pre>
</div>
</div>
</section>
<section id="section-2" class="slide level2">
<h2></h2>
<div class="cell" data-execution_count="15">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="kw">twoway</span> <span class="kw">kdensity</span> pp_mean || <span class="kw">kdensity</span> np_mean</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="slides_files/figure-revealjs/cell-16-output-1.svg" class="r-stretch"></section>
<section id="section-3" class="slide level2">
<h2></h2>
<div class="cell" data-execution_count="16">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="kw">twoway</span> <span class="kw">scatter</span> pp_mean np_mean, <span class="bn">mlabel</span>(country) || <span class="co">///</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">y</span> = x, <span class="kw">range</span>(4.5 9) <span class="co">///</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  aspect(1) <span class="bn">ytitle</span>(<span class="st">"Partial pooling"</span>) <span class="bn">xtitle</span>(<span class="st">"No pooling"</span>) <span class="co">///</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="bn">legend</span>(<span class="kw">off</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="slides_files/figure-revealjs/cell-17-output-1.svg" class="r-stretch"></section>
<section id="caterpillar-plot" class="slide level2">
<h2>Caterpillar plot</h2>
<div class="cell" data-execution_count="17">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="kw">quietly</span>{</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>    snapshot <span class="kw">restore</span> 1                                                        <span class="co">// ensure original data</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">qui</span> mixed stflife || country:                                             <span class="co">// null model (partially pooled means)</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">bysort</span> country: <span class="kw">gen</span> first = <span class="dt">_n</span>                                            <span class="co">// create unique index in each country</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">predict</span> rand_int, <span class="kw">reffects</span>                                                <span class="co">// get PP mean estimates for each country</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">predict</span> rand_int_se, reses                                                <span class="co">// get standard errors of mean estimates</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">keep</span> <span class="kw">if</span> first == 1                                                        <span class="co">// keep only one copy of each country</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">gen</span> int_high = rand_int + 1.96*rand_int_se                                <span class="co">// upper bound of estimate</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">gen</span> int_low  = rand_int - 1.96*rand_int_se                                <span class="co">// lower bound of estimate</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">sort</span> rand_int                                                             <span class="co">// sort lowest to highest</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">gen</span> <span class="fu">rank</span> = <span class="dt">_n</span>                                                             <span class="co">// create sort order variable for plot</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">twoway</span> rcap int_low int_high <span class="fu">rank</span> || <span class="co">///                                  // rcap is confidence bounds sorted by rank</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>      <span class="kw">scatter</span> rand_int <span class="fu">rank</span>, <span class="bn">mlabel</span>(country) mlabpos(12) <span class="bn">legend</span>(<span class="kw">off</span>) <span class="co">///      // scatter gives points</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>      <span class="kw">xlabel</span>(<span class="kw">none</span>) <span class="bn">xtitle</span>(<span class="st">""</span>) <span class="bn">ytitle</span>(<span class="st">"PP estimate of intercept"</span>)</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>    snapshot <span class="kw">restore</span> 1                                                        <span class="co">// restore original data for later</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="slides_files/figure-revealjs/cell-18-output-1.svg" class="r-stretch"></section>
<section id="what-about-complete-pooling" class="slide level2">
<h2>What about complete pooling?</h2>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="kw">summarize</span> stflife</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     stflife |      5,000      6.7362    2.340108          0         10</code></pre>
</div>
</div>
<p>Complete pooling assumes every country has the same <em>population</em> mean and that apparent differences (in the sample) only arise from sampling error.</p>
</section>
<section id="choosing-the-right-model" class="slide level2">
<h2>Choosing the “right” model</h2>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> eststo NPM: <span class="kw">reg</span> stflife i.country       <span class="co">// take with a grain of salt</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> eststo PPM: mixed stflife || country:</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> eststo CPM: <span class="kw">reg</span> stflife</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="kw">estimates</span> <span class="kw">stats</span> NPM PPM CPM</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Akaike's information criterion and Bayesian information criterion

-----------------------------------------------------------------------------
       Model |          N   ll(null)  ll(model)      df        AIC        BIC
-------------+---------------------------------------------------------------
         NPM |      5,000  -11345.18  -10961.74      29   21981.47   22170.47
         PPM |      5,000          .  -11016.19       3   22038.38   22057.93
         CPM |      5,000  -11345.18  -11345.18       1   22692.36   22698.87
-----------------------------------------------------------------------------
Note: BIC uses N = number of observations. See [R] IC note.</code></pre>
</div>
</div>
<p>The LL of <code>NPM</code> is actually a little better than <code>PPM</code> but the BIC suggests this is from overfitting the data. There are more parsimonious ways of specifying the <code>NPM</code>, which we’ll see later.</p>
</section>
<section id="the-bayesian-information-criterion-bic" class="slide level2">
<h2>The Bayesian Information Criterion (BIC)</h2>
<ul>
<li>The Bayesian Information Criterion is a <em>penalized-likelihood</em> criterion that attempts to trade off accuracy and parsimony in order to find the “true model.”</li>
<li>Of course the true model probably isn’t under consideration but this is still a reasonable decision rule to take the lowest value among the models being considered.</li>
<li>The formula is <span class="math inline">\(-2LL + p(\text{log}(n))\)</span>.</li>
</ul>
</section>
<section id="interpreting-the-bic" class="slide level2">
<h2>Interpreting the BIC</h2>
<p><img data-src="images/bic.png" width="1296"></p>

<aside><div>
<p>See Raftery (1995). <a href="https://www.jstor.org/stable/271063">Bayesian Model Selection in Social Research</a>. <em>Sociological Methodology</em>, 25(3), 111-163.</p>
</div></aside></section>
<section id="questions-about-one-dimension" class="slide level2">
<h2>Questions about one dimension?</h2>
</section></section>
<section>
<section id="two-dimensions" class="title-slide slide level1 center">
<h1>Two dimensions</h1>

</section>
<section id="initial-research-question" class="slide level2">
<h2>Initial “research” question</h2>
<ul>
<li>Does education cause greater life satisfaction?</li>
<li>Predictor is years of education (0-20)</li>
<li>We want to use the data the best we can to estimate the effect of education on life satisfaction.</li>
</ul>
</section>
<section id="education-and-satisfaction-by-country" class="slide level2">
<h2>Education and satisfaction by country</h2>
<div class="cell" data-execution_count="20">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="kw">twoway</span> <span class="kw">lfit</span> stflife eduyrs, lcolor(<span class="kw">red</span>) || <span class="co">///</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">scatter</span> stflife eduyrs, jitter(3)  mcolor(<span class="bn">blue</span>%10) ||, <span class="co">///</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">by</span>(country, <span class="bn">legend</span>(<span class="kw">off</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="slides_files/figure-revealjs/cell-21-output-1.svg" class="r-stretch"></section>
<section id="are-these-differences-real" class="slide level2">
<h2>Are these differences “real”?</h2>
<p>We have the same issue here we had with means. How do we want to estimate the effect of education?</p>
<ul>
<li>No pooling (analyze each country separately)</li>
<li>Partial pooling (combine within- and between-country variance using shrinkage)</li>
<li>Complete pooling (assume the same relationship in all countries)</li>
</ul>
<p>Because we have to make these decisions for both intercepts and slopes, we have choices to make about how to combine them.</p>
</section>
<section id="a-note-on-variable-scaling" class="slide level2">
<h2>A note on variable scaling</h2>
<p>For all variables in this course, I’m going to rescale them to range from 0 (minimum) to 1 (maximum). This will allow us to compare the <em>maximum difference</em> to the outcome each factor might make given the model’s assumptions (e.g., linearity of effect).</p>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>  <span class="co">// this is the original education variable divided by the range</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> eduyrs01 = eduyrs/20</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>

<aside><div>
<p>See Cohen et al.&nbsp;1999. <a href="https://doi.org/10.1207/S15327906MBR3403_2">“The Problem of Units and the Circumstance for POMP.”</a> <em>Multivariate Behavioral Research</em> 34(3):315–-46.</p>
</div></aside></section>
<section id="no-pooling-3" class="slide level2">
<h2>No pooling</h2>
<p>No pooling models are very simple. In effect, you are estimating separate models for each country. This model will give you exactly the same predictions as the faceted graph we made already, although in one regression model rather than 29 separate ones.</p>
<p><strong>Model syntax:</strong> <code>regress stflife c.eduyrs01##i.country</code></p>
</section>
<section id="basic-mixed-effects-model" class="slide level2">
<h2>Basic mixed effects model</h2>
<p><span class="math inline">\(y_{ij} = \mu + \beta x_{ij} + \alpha_{j} + \epsilon_{ij}\)</span></p>
<p><span class="math inline">\(\alpha_j \sim N(0,\tau^2)\)</span></p>
<p><span class="math inline">\(\epsilon_{ij} \sim N(0,\sigma^2)\)</span></p>
<p>The intercepts are allowed to vary by country but the effect of <span class="math inline">\(X\)</span> on <span class="math inline">\(Y\)</span> (i.e., <span class="math inline">\(\beta\)</span>) is assumed to be the same across all countries.</p>
</section>
<section id="partially-pooled-intercepts-and-slopes" class="slide level2">
<h2>Partially pooled intercepts and slopes</h2>
<p><span class="math inline">\(y_{ij} = \beta_0 + \alpha_{0j} +(\beta_{1} + \alpha_{1j} ) x_{ij} + \epsilon_{ij}\)</span></p>
<p><span class="math inline">\(\alpha_{0j} \sim N(0,\tau_0^2)\)</span></p>
<p><span class="math inline">\(\alpha_{1j} \sim N(0,\tau_1^2)\)</span></p>
<p><span class="math inline">\(\tau_{01} = \text{cov}(\alpha_{0j},\alpha_{1j}) \quad\)</span> [covariance between random components]</p>
<p><span class="math inline">\(\epsilon_{ij} \sim N(0,\sigma^2)\)</span></p>

<aside><div>
<p>Note that I’m changing notation here so that random effects are all designated by <span class="math inline">\(\alpha\)</span>s and all random effects variances are designated as <span class="math inline">\(\tau^2\)</span>s. To get the numbering right, I’m changing <span class="math inline">\(\mu\)</span> to <span class="math inline">\(\beta_0\)</span>.</p>
<p>It is more complicated than the last model in that it adds two parameters: a variance for the random component of <span class="math inline">\(\beta_1\)</span> and a covariance between the random slope and intercept.</p>
</div></aside></section>
<section id="specifying-the-two-models-in-stata" class="slide level2">
<h2>Specifying the two models in Stata</h2>
<h3 id="mixed-model-with-fixed-education-slope">Mixed model with fixed education slope</h3>
<p><code>mixed stflife eduyrs01 || country:</code></p>
<h3 id="mixed-model-with-varying-education-slope">Mixed model with varying education slope</h3>
<p><code>mixed stflife eduyrs01 || country: eduyrs01, cov(unstructured)</code></p>
</section>
<section id="output-cp-slope" class="slide level2">
<h2>Output (CP slope)</h2>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>mixed stflife eduyrs01 || country: , <span class="kw">nolog</span> <span class="kw">noheader</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
------------------------------------------------------------------------------
     stflife | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
    eduyrs01 |   1.058417   .1717719     6.16   0.000     .7217507    1.395084
       _cons |     6.3301   .2165481    29.23   0.000     5.905674    6.754527
------------------------------------------------------------------------------</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
------------------------------------------------------------------------------
  Random-effects parameters  |   Estimate   Std. err.     [95% conf. interval]
-----------------------------+------------------------------------------------
country: Identity            |
                  var(_cons) |   .8928955   .2574149      .5074647     1.57107
-----------------------------+------------------------------------------------
               var(Residual) |   4.687569   .0940044      4.506898    4.875483
------------------------------------------------------------------------------
LR test vs. linear model: chibar2(01) = 644.33        Prob &gt;= chibar2 = 0.0000</code></pre>
</div>
</div>
</section>
<section id="output-pp-slope" class="slide level2">
<h2>Output (PP slope)</h2>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>mixed stflife eduyrs01 || country: eduyrs01 , cov(<span class="kw">unstructured</span>) <span class="kw">nolog</span> <span class="kw">noheader</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>------------------------------------------------------------------------------
     stflife | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
    eduyrs01 |   .9904447   .1860232     5.32   0.000     .6258461    1.355043
       _cons |   6.375491   .2567107    24.84   0.000     5.872347    6.878635
------------------------------------------------------------------------------

------------------------------------------------------------------------------
  Random-effects parameters  |   Estimate   Std. err.     [95% conf. interval]
-----------------------------+------------------------------------------------
country: Unstructured        |
               var(eduyrs01) |   .1381695          .             .           .
                  var(_cons) |   1.393742   .3116021      .8992431    2.160168
         cov(eduyrs01,_cons) |   -.438831          .             .           .
-----------------------------+------------------------------------------------</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>               var(Residual) |   4.684348     .09394      4.503801    4.872133
------------------------------------------------------------------------------
LR test vs. linear model: chi2(3) = 647.59                Prob &gt; chi2 = 0.0000

Note: LR test is conservative and provided only for reference.</code></pre>
</div>
</div>
</section>
<section id="np-intercept-np-slope" class="slide level2">
<h2>NP intercept / NP slope</h2>
<div class="cell" data-execution_count="24">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>spagplot stflife eduyrs01, id(country)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="slides_files/figure-revealjs/cell-25-output-1.svg" class="r-stretch"></section>
<section id="pp-intercept-pp-slope" class="slide level2">
<h2>PP intercept / PP slope</h2>
<div class="cell" data-execution_count="25">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> mixed stflife eduyrs01 || country: eduyrs01, cov(uns) </span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">predict</span> yhat_pp, <span class="kw">fitted</span>                               <span class="co">// fitted gives correct predictions</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>spagplot yhat_pp eduyrs01, id(country)                    <span class="co">// outcome is now yhat_pp</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="slides_files/figure-revealjs/cell-26-output-1.svg" class="r-stretch"></section>
<section id="pp-intercept-cp-slope" class="slide level2">
<h2>PP intercept / CP slope</h2>
<div class="cell" data-execution_count="26">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> mixed stflife eduyrs01 || country:     <span class="co">// no random slope means CP slope</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">predict</span> yhat_cp, <span class="kw">fitted</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>spagplot yhat_cp eduyrs01, id(country)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="slides_files/figure-revealjs/cell-27-output-1.svg" class="r-stretch"></section>
<section id="interpreting-coefficients" class="slide level2">
<h2>Interpreting coefficients</h2>
<ul>
<li>The interpretation of <span class="math inline">\(\beta\)</span> is somewhat different with and without random slopes.</li>
<li>In the <em>complete pooling</em> slope model, the <code>eduyrs01</code> coefficient is <em>the</em> effect of education. Every country is contributing all the information it has (a lot or a little) to the same story of <em>one</em> effect.</li>
<li>In the <em>partial pooling</em> slope model, the <code>eduyrs01</code> coefficient is the effect of education <em>in a typical country</em>. It’s the starting point for <em>every</em> country’s slope but not the slope for <em>any</em> particular country. To get a country’s slope, you need to combine the “fixed” portion with the “random” component for each country.</li>
</ul>
</section>
<section id="do-i-need-variable-slopes" class="slide level2">
<h2>Do I need variable slopes?</h2>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> eststo oneslope: <span class="kw">qui</span> mixed stflife eduyrs01 || country:</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> eststo varslope: <span class="kw">qui</span> mixed stflife eduyrs01 || country: eduyrs01, cov(uns)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="kw">est</span> <span class="kw">stats</span> oneslope varslope</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Akaike's information criterion and Bayesian information criterion

-----------------------------------------------------------------------------
       Model |          N   ll(null)  ll(model)      df        AIC        BIC
-------------+---------------------------------------------------------------
    oneslope |      5,000          .  -10997.28       4   22002.56   22028.63
    varslope |      5,000          .  -10995.65       5    22001.3   22033.89
-----------------------------------------------------------------------------
Note: BIC uses N = number of observations. See [R] IC note.</code></pre>
</div>
</div>
</section>
<section id="additional-considerations-for-mixed-models" class="slide level2">
<h2>Additional considerations for mixed models</h2>
<ul>
<li>Number of clusters
<ul>
<li>there are many rules of thumb but no solid rules</li>
<li>at least 20 is probably a good idea</li>
</ul></li>
<li>Cluster size
<ul>
<li>small clusters (even n = 1) are OK with partial pooling/RE models because the whole distribution of clusters is used to generate estimates.</li>
</ul></li>
</ul>
<p>See the helpful and accessible summary in Robson and Pevalin (2016).</p>
</section></section>
<section>
<section id="multivariate-models" class="title-slide slide level1 center">
<h1>Multivariate models</h1>

</section>
<section id="types-of-variables-and-their-variance" class="slide level2">
<h2>Types of variables and their variance</h2>
<table>
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Examples</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>L2 only</strong></td>
<td style="text-align: left;">Vars that only vary between L2 units</td>
<td style="text-align: left;">GDP</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>L1 with L1 and L2 variation</strong></td>
<td style="text-align: left;">Vars that are measured at L1 but have both types of variance</td>
<td style="text-align: left;">age, education</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>L1 with only L1 variation</strong> (rare or constructed)</td>
<td style="text-align: left;">Vars that are constructed to have only L1 variance</td>
<td style="text-align: left;">in-country income percentile, “group mean centered” variables</td>
</tr>
</tbody>
</table>
</section>
<section id="outcome-variables-are-middle-type" class="slide level2">
<h2>Outcome variables are “middle type”</h2>
<ul>
<li>Outcomes in multilevel models have both <em>within</em> and <em>between</em> variance.</li>
<li>That’s what the ICC measures!</li>
<li>Our models can do better or worse at accounting for between or within variance:
<ul>
<li>Imagine a model that perfectly predicts the country means but tells us nothing about within-country differences</li>
<li>Imagine a model that perfectly predicts within-country differences but cannot tell us why country means vary</li>
</ul></li>
</ul>
</section>
<section id="rescaling-and-labeling-predictors" class="slide level2">
<h2>Rescaling and labeling predictors</h2>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> v <span class="kw">of</span> <span class="kw">varlist</span> agea attend health inc {     <span class="co">// list of predictors I want to rescale</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">qui</span> <span class="kw">sum</span> <span class="ot">`v'</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">gen</span> <span class="ot">`v'</span>01 = (<span class="ot">`v'</span> - <span class="ot">`r(min)'</span>) / (<span class="ot">`r(max)'</span> - <span class="ot">`r(min)'</span>)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">// add variable labels  </span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>la <span class="kw">var</span> stflife <span class="st">"Life Satisfaction"</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>la <span class="kw">var</span> eduyrs01 <span class="st">"Education"</span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>la <span class="kw">var</span> agea01 <span class="st">"Age"</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>la <span class="kw">var</span> attend01 <span class="st">"Attendance"</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>la <span class="kw">var</span> health01 <span class="st">"Health"</span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>la <span class="kw">var</span> inc01 <span class="st">"Income"</span></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>la <span class="kw">var</span> female <span class="st">"Female"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="base-model-with-l1-covariates" class="slide level2">
<h2>Base model with “L1” covariates</h2>
<div class="cell" data-execution_count="29">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>mixed stflife eduyrs01 c.agea01##c.agea01 attend01 health01 inc01 female || country: , <span class="kw">nolog</span> <span class="kw">noheader</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
-----------------------------------------------------------------------------------
          stflife | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]
------------------+----------------------------------------------------------------
         eduyrs01 |   .1663035   .1775243     0.94   0.349    -.1816376    .5142447
           agea01 |  -4.336436   .5604827    -7.74   0.000    -5.434961    -3.23791
                  |
c.agea01#c.agea01 |   6.777315   .6742863    10.05   0.000     5.455739    8.098892
                  |
         attend01 |   .6993313   .1225424     5.71   0.000     .4591526    .9395099
         health01 |    2.77101   .1458833    18.99   0.000     2.485083    3.056936
            inc01 |   1.369883   .1035474    13.23   0.000     1.166934    1.572832
           female |   .0938358   .0583006     1.61   0.108    -.0204313    .2081028
            _cons |   4.404905   .2511313    17.54   0.000     3.912697    4.897114
-----------------------------------------------------------------------------------

------------------------------------------------------------------------------
  Random-effects parameters  |   Estimate   Std. err.     [95% conf. interval]
-----------------------------+------------------------------------------------
country: Identity            |</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                  var(_cons) |   .6781084   .1983499      .3822245    1.203039
-----------------------------+------------------------------------------------
               var(Residual) |   4.095138   .0821237        3.9373    4.259302
------------------------------------------------------------------------------
LR test vs. linear model: chibar2(01) = 506.67        Prob &gt;= chibar2 = 0.0000</code></pre>
</div>
</div>
</section>
<section id="visualizing-quadratics" class="slide level2">
<h2>Visualizing quadratics</h2>
<div class="cell" data-execution_count="30">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> margins, <span class="fu">at</span>(agea01 = (0(.1)1)) <span class="co">// from 0 to 1 in increments of .1</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>marginsplot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Variables that uniquely identify margins: agea01</code></pre>
</div>

</div>
<img data-src="slides_files/figure-revealjs/cell-31-output-2.svg" class="r-stretch"></section>
<section id="variance-explained-by-level" class="slide level2">
<h2>Variance “explained” by level</h2>
<h4 id="within-or-level-1">Within or Level 1</h4>
<p><span class="math display">\[R_{(W)}^2 = \frac{\sigma_0^2-\sigma_1^2}{\sigma_0^2}\]</span></p>
<h4 id="between-or-level-2">Between or Level 2</h4>
<p><span class="math display">\[R_{(B)}^2 = \frac{\tau_0^2-\tau_1^2}{\tau_0^2}\]</span></p>
<h4 id="total">Total</h4>
<p><span class="math display">\[R_{(T)}^2 = \frac{(\tau_0^2 +\sigma_0^2) - (\tau_1^2 +\sigma_1^2)}{\tau_0^2 +\sigma_0^2}\]</span></p>
</section>
<section id="calculating-r2" class="slide level2">
<h2>Calculating R<sup>2</sup></h2>
<p>I wrote an updated version of <code>mltrsq</code> from the <code>mlt</code> package. It’s included in your files and called <code>mlmrsq.ado</code>. It provides the Bryk and Raudenbush R<sup>2</sup> values from the last model.</p>
<div class="cell" data-execution_count="31">
<div class="cell-output cell-output-stdout">
<pre><code>Level 2 variable is country 
 
 
Calculating R-squared for the parameters of
 eduyrs01 agea01 c.agea01#c.agea01 attend01 health01 inc01 female and _cons
   
   
Number of macro-units:    29</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   
   
Bryk/Raudenbush R-squared Total:    0.1535
Bryk/Raudenbush R-squared Level 1:  0.1329
Bryk/Raudenbush R-squared Level 2:  0.2595</code></pre>
</div>
</div>

<aside><div>
<p>Make sure this is in your ado folder. Type <code>sysdir</code> in Stata to see where your ado folder is.</p>
</div></aside></section>
<section id="including-those-scalars-in-tables" class="slide level2">
<h2>Including those scalars in tables</h2>
<pre><code>esttab ., keep(`e(depvar)':) b(3) t(2) wide compress ///
  nodepvar nomtitle abs ///
    interaction(" x ") nostar varwidth(20) label ///
    stats(N_l2 N br_rsq_l2 br_rsq_l1 br_rsq_to, ///
      label("N: Level 2" "N: Level 1" "R2 Between" /// 
        "R2 Within" "R2 Total") ///
        fmt(%9.0f %9.0f %9.3f)) ///
        varlabel(_cons Constant) eqlabels(none)</code></pre>

<aside><div>
<p><code>br_rsq_l2</code> is level 2 R<sup>2</sup>, <code>br_rsq_l1</code> is level 1 R<sup>2</sup>, and <code>br_rsq_to</code> is total R<sup>2</sup>. There are too many options to outline here but I recommend reading the help file for <code>esttab</code>. You can also read more about Ben Jann’s <code>esttab</code> package in <a href="https://www.stata-journal.com/article.html?article=st0085">this Stata Journal article</a>.</p>
</div></aside></section>
<section id="resulting-table" class="slide level2">
<h2>Resulting table</h2>
<div class="cell" data-execution_count="32">
<div class="cell-output cell-output-stdout">
<pre><code>
------------------------------
                 (1)          
------------------------------
Constant       4.405   (17.54)
Education      0.166    (0.94)
Age           -4.336    (7.74)
Age x Age      6.777   (10.05)
Attendance     0.699    (5.71)
Health         2.771   (18.99)
Income         1.370   (13.23)
Female         0.094    (1.61)
------------------------------
N: Level 2        29          
N: Level 1      5000          
R2 Between       .26          
R2 Within       .133          
R2 Total        .153          
BIC          21400.6          
------------------------------
Absolute t statistics in parentheses</code></pre>
</div>
</div>
</section>
<section id="making-sense-of-the-results" class="slide level2">
<h2>Making sense of the results</h2>
<ul>
<li>How can a model with predictors measured at the individual level account for <em>more</em> of the variation at the country level than at the individual level?</li>
<li>Don’t confuse where a variable is <em>measured</em> with where a variable <em>varies</em>. You always need to ask “where is the variance?”</li>
</ul>
</section>
<section id="where-is-the-variance-1" class="slide level2">
<h2>Where is the variance?</h2>
<p>We can use <code>mixed</code> and <code>estat icc</code> to assess where the variance is in any variable, not just the outcome.</p>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> v <span class="kw">of</span> <span class="kw">varlist</span> *01 {       <span class="co">// for all variables ending in 01</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">qui</span> mixed <span class="ot">`v'</span> || country:      <span class="co">// estimate null model</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">qui</span> <span class="kw">estat</span> icc                  <span class="co">// get ICC</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">noi</span> <span class="kw">di</span> <span class="st">"`v'"</span>, %9.3g <span class="ot">`r(icc2)'</span>  <span class="co">// display the name of the variable and ICC</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>eduyrs01     .0927</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>agea01      .019</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>attend01      .116</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>health01     .0778</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>inc01     .0573</code></pre>
</div>
</div>
<p>There are, for example, almost no countrye differences in average age (ICC/VPC is 1.9%). But there are more country-level differences in average religious attendance (ICC/VPC is 11.6%).</p>
</section>
<section id="adding-level-2-predictors" class="slide level2">
<h2>Adding level-2 predictors</h2>
<p><span class="math inline">\(y_{ij} = \mu + \boldsymbol {x_{ij} \beta } + \boldsymbol{ z_j \gamma } + u_{j} + \epsilon_{ij}\)</span></p>
<p><span class="math inline">\(u_j \sim N(0,\tau^2)\)</span></p>
<p><span class="math inline">\(\epsilon_{ij} \sim N(0,\sigma^2)\)</span></p>
<p>We don’t need to do anything special to add “level-2” predictors. We can simply add them to the model. These variables are different in the sense that they only vary at level 2 (e.g., GDP at the country level).</p>
<p>To keep the differences in mind, I will use <span class="math inline">\(\boldsymbol{x_{ij}}\)</span> to denote predictors with at least some within and between variation and <span class="math inline">\(\boldsymbol{z_j}\)</span> to denote predictors with only level-2 variability.</p>
</section>
<section id="adding-gni" class="slide level2">
<h2>Adding GNI</h2>
<p>In the ESS dataset, I have included many country-level variables that are (almost all) prefixed with <code>c_</code>. I kept many of them in case you wanted to play with the dataset a bit more. But we’ll only be focusing on gross national income (GNI), which is a measure of the economic value produced or owned by citizens of that country. The variable <code>gnipc1000</code> is this value per capita in thousands of euros. Let’s take a look at this variable.</p>
</section>
<section id="gni-distribution" class="slide level2">
<h2>GNI Distribution</h2>
<div class="cell" data-execution_count="34">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="kw">qbys</span> country: <span class="kw">gen</span> index_num = <span class="dt">_n</span>                      <span class="co">// create a new counting variable within countries (1, 2, 3...)</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="kw">hist</span> gnipc1000 <span class="kw">if</span> index_num == 1, <span class="kw">width</span>(10) <span class="bn">start</span>(0)  <span class="co">// do a histogram with one observation per country</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(bin=11, start=0, width=10)</code></pre>
</div>

</div>
<img data-src="slides_files/figure-revealjs/cell-35-output-2.svg" class="r-stretch"></section>
<section id="standardizing-or-scaling-a-level-2-variable" class="slide level2">
<h2>Standardizing or scaling a level-2 variable</h2>
<p>When we’re z-score standardizing any variable, we have to think about the sample over which we’re calculating the mean and SD. Do we want to use the pooled sample (where clusters are effectively weighted according to their <span class="math inline">\(N\)</span>) or a sample where each cluster’s cases count equally (“one cluster, one vote”)? These are often called, respectively, the weighted and unweighted grand mean.</p>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">sum</span> gnipc1000                                           <span class="co">// summarize to get min and max in the return list</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> gni01 = (gnipc1000 - <span class="ot">`r(min)'</span>) / (<span class="ot">`r(max)'</span> - <span class="ot">`r(min)'</span>)  <span class="co">// subtract maximum, divide by range</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="kw">label</span> <span class="kw">var</span> gni01 <span class="st">"GNI pc"</span>                                    <span class="co">// add a variable label for tables and plots</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For pure level-2 variables, it generally makes more sense to standardize so that each cluster only counts once. Here we are simply going to min/max rescale so that we don’t have to worry about this issue!</p>
</section>
<section id="comparing-models-prep" class="slide level2">
<h2>Comparing models (prep)</h2>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="kw">quietly</span> {</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// null model</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>  mixed stflife || country:</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">est</span> <span class="kw">store</span> M0</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>  estadd <span class="fu">scalar</span> N_l2 = 29 <span class="co">// manually adding because we cannot use mlmrsq without predictors</span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// all *01 variables EXCEPT gni01</span></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>  mixed stflife eduyrs01 c.agea01##c.agea01 attend01 health01 inc01 || country:</span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>  mlmrsq</span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">est</span> <span class="kw">store</span> M1</span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// all *01 variables (now including gni01)</span></span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a>  mixed stflife *01 c.agea01#c.agea01 || country:</span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a>  mlmrsq</span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true" tabindex="-1"></a>  <span class="kw">est</span> <span class="kw">store</span> M2</span>
<span id="cb76-20"><a href="#cb76-20" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="comparing-models-results" class="slide level2">
<h2>Comparing models (results)</h2>
<div class="cell" data-execution_count="37">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>esttab M0 M1 M2, <span class="kw">keep</span>(<span class="ot">`e(depvar)'</span>:) b(3) t(2) <span class="kw">wide</span> <span class="kw">compress</span> <span class="co">///</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  nodepvar nomtitle <span class="fu">abs</span> <span class="co">///</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>  interaction(<span class="st">" x "</span>) nostar varwidth(10) <span class="kw">label</span> <span class="co">///</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">stats</span>(N_l2 <span class="kw">N</span> br_rsq_l2 br_rsq_l1 br_rsq_to bic, <span class="co">///</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">label</span>(<span class="st">"N: Level 2"</span> <span class="st">"N: Level 1"</span> <span class="st">"R2 Between"</span> <span class="co">/// </span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"R2 Within"</span> <span class="st">"R2 Total"</span> <span class="st">"BIC"</span>) <span class="co">///</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>    fmt(%7.0f %7.0f %7.3g %7.3g %7.3g %7.1f)) <span class="kw">order</span>(<span class="dt">_cons</span>) <span class="co">///</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>    varlabel(<span class="dt">_cons</span> Constant) eqlabels(<span class="kw">none</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
----------------------------------------------------------------------
                 (1)                 (2)                 (3)          
----------------------------------------------------------------------
Constant       6.999   (36.92)     4.453   (17.86)     3.569   (14.62)
Education                          0.174    (0.98)     0.160    (0.90)
Age                               -4.320    (7.71)    -4.365    (7.79)
Age x Age                          6.760   (10.02)     6.789   (10.07)
Attendance                         0.719    (5.90)     0.733    (6.03)
Health                             2.763   (18.95)     2.747   (18.86)
Income                             1.360   (13.15)     1.364   (13.22)
GNI pc                                                 2.985    (6.81)
----------------------------------------------------------------------
N: Level 2        29                  29                  29          
N: Level 1      5000                5000                5000          
R2 Between                          .261                .774          
R2 Within                           .132                .132          
R2 Total                            .153                .236          
BIC          22057.9             21394.7             21377.5          
----------------------------------------------------------------------
Absolute t statistics in parentheses</code></pre>
</div>
</div>
<p>Notice the large increase in R<sup>2</sup> at level 2 once we add the gross national income variable!</p>
</section>
<section id="taking-stock-of-our-research-question" class="slide level2">
<h2>Taking stock of our “research question”</h2>
<p>It doesn’t look like education matters one way or another for life satisfaction. Once we adjust for other factors (like income), the difference between the most and least educated respondents is very small. For now we’ll change our focus to income.</p>
</section>
<section id="does-the-effect-of-income-vary-by-country" class="slide level2">
<h2>Does the effect of income vary by country?</h2>
<p>Let’s add a variable slope at the country level:</p>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> mixed stflife *01 c.agea01#c.agea01 || country: inc01, cov(uns)  <span class="co">// variable slope added</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> mlmrsq</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="kw">est</span> <span class="kw">store</span> M3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="comparison-table" class="slide level2">
<h2>Comparison table</h2>
<div class="cell" data-execution_count="39">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>esttab M0 M1 M2 M3, <span class="kw">keep</span>(<span class="ot">`e(depvar)'</span>:) b(3) t(2) <span class="kw">wide</span> <span class="kw">compress</span> <span class="co">///</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>  nodepvar nomtitle <span class="fu">abs</span> <span class="co">///</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  interaction(<span class="st">" x "</span>) nostar varwidth(10) <span class="kw">label</span> <span class="co">///</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">stats</span>(N_l2 <span class="kw">N</span> br_rsq_l2 br_rsq_l1 br_rsq_to aic bic, <span class="co">///</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">label</span>(<span class="st">"N: Level 2"</span> <span class="st">"N: Level 1"</span> <span class="st">"R2 Between"</span> <span class="co">/// </span></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"R2 Within"</span> <span class="st">"R2 Total"</span> <span class="st">"AIC"</span> <span class="st">"BIC"</span>) <span class="co">///</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>    fmt(%7.0f %7.0f %7.3g %7.3g %7.3g %7.1f)) <span class="co">///</span></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>    eqlabels(<span class="kw">none</span>) <span class="kw">order</span>(<span class="dt">_cons</span> eduyrs01 agea01 c.agea01#c.agea01) <span class="co">///</span></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>    varlabel(<span class="dt">_cons</span> Constant) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
------------------------------------------------------------------------------------------
                 (1)                 (2)                 (3)                 (4)          
------------------------------------------------------------------------------------------
Constant       6.999   (36.92)     4.453   (17.86)     3.569   (14.62)     3.570   (14.19)
Education                          0.174    (0.98)     0.160    (0.90)     0.143    (0.80)
Age                               -4.320    (7.71)    -4.365    (7.79)    -4.378    (7.80)
Age x Age                          6.760   (10.02)     6.789   (10.07)     6.802   (10.07)
Attendance                         0.719    (5.90)     0.733    (6.03)     0.739    (6.07)
Health                             2.763   (18.95)     2.747   (18.86)     2.759   (18.95)
Income                             1.360   (13.15)     1.364   (13.22)     1.406   (10.15)
GNI pc                                                 2.985    (6.81)     2.936    (6.79)
------------------------------------------------------------------------------------------
N: Level 2        29                  29                  29                  29          
N: Level 1      5000                5000                5000                5000          
R2 Between                          .261                .774                .774          
R2 Within                           .132                .132                .132          
R2 Total                            .153                .236                .236          
AIC          22038.4             21336.0             21312.4             21311.9          
BIC          22057.9             21394.7             21377.5             21390.1          
------------------------------------------------------------------------------------------
Absolute t statistics in parentheses</code></pre>
</div>
</div>
<p>The AIC suggests the inclusion of variable slopes might produce a tiny improvement, but the BIC suggests the more complex model is overfitting the data.</p>
</section>
<section id="plotting-the-variable-slope" class="slide level2 smaller">
<h2>Plotting the variable slope</h2>
<p>We can’t use <code>spagplot</code> in the “simple” way because there are control variables. This code will get you predictions by country and income holding all other variables at their means.</p>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="kw">predict</span> m3_re*, <span class="kw">reffects</span>                                  <span class="co">// get RE BLUPS for slope and intercept</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> b_inc = _b[inc01]                                   <span class="co">// get slope for later</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> margins, atmeans <span class="fu">at</span>(inc01=0) <span class="kw">post</span>                     <span class="co">// post to get correct intercept</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> yhat_M3 = _b[<span class="dt">_cons</span>] + m3_re2 + (<span class="ot">`b_inc'</span>+m3_re1)*inc01 <span class="co">// predicted value  </span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>spagplot yhat_M3 inc01, id(country)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="slides_files/figure-revealjs/cell-41-output-1.svg" class="r-stretch"></section>
<section id="adding-more-random-slopes" class="slide level2">
<h2>Adding more random slopes</h2>
<p>You can add random slopes to any variable with level-1 variance. An unstructured covariance can be challenging to estimate with many random slopes so you may have better luck with the independent covariance matrix for the random effects. This just means information is not being shared across terms.</p>
<p>Adding <code>cov(independent)</code> instead of <code>cov(unstructured)</code> means we assume zero correlations between random components.</p>
</section>
<section id="results" class="slide level2 smaller">
<h2>Results</h2>
<div class="cell" data-execution_count="41">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>mixed stflife *01 c.agea01#c.agea01 <span class="co">///</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>  || country: eduyrs01 agea01 attend01 health01 inc01 <span class="co">///  add random slopes to all these</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>  , cov(<span class="kw">independent</span>) <span class="kw">noheader</span> <span class="kw">nolog</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>-----------------------------------------------------------------------------------
          stflife | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]
------------------+----------------------------------------------------------------
         eduyrs01 |   .1754954   .1776917     0.99   0.323    -.1727738    .5237647
           agea01 |  -4.214946   .5880488    -7.17   0.000    -5.367501   -3.062392
         attend01 |   .7274526   .1901212     3.83   0.000     .3548219    1.100083
         health01 |   2.716094    .148523    18.29   0.000     2.424994    3.007193
            inc01 |   1.410073   .1209441    11.66   0.000     1.173027    1.647119
            gni01 |   3.006926   .3980466     7.55   0.000     2.226769    3.787083
                  |
c.agea01#c.agea01 |   6.656627   .6796347     9.79   0.000     5.324568    7.988687
                  |
            _cons |   3.509123   .2288118    15.34   0.000      3.06066    3.957586
-----------------------------------------------------------------------------------

------------------------------------------------------------------------------
  Random-effects parameters  |   Estimate   Std. err.     [95% conf. interval]
-----------------------------+------------------------------------------------
country: Independent         |
               var(eduyrs01) |   7.72e-13   3.53e-10             0           .
                 var(agea01) |   .4475077   .2511517      .1489658    1.344357
               var(attend01) |   .3313237   .1987703      .1022335    1.073772
               var(health01) |    .011417   .0647176      1.71e-07    763.1769
                  var(inc01) |   .0499519   .0503699      .0069219    .3604763</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                  var(_cons) |    .081943   .0703796      .0152205    .4411603
-----------------------------+------------------------------------------------
               var(Residual) |    4.05702    .081855      3.899718    4.220667
------------------------------------------------------------------------------
LR test vs. linear model: chi2(6) = 176.57                Prob &gt; chi2 = 0.0000

Note: LR test is conservative and provided only for reference.</code></pre>
</div>
</div>
<p>There are some troubling signs here (with <code>eduyrs01</code> and <code>health01</code>) but this gives you the general idea.</p>
</section>
<section id="what-is-a-random-slope" class="slide level2">
<h2>What <em>is</em> a random slope?</h2>
<ul>
<li>When we do partial pooling for a slope, we estimate a random component that causes the effect of a variable’s level-1 variance to vary by group (level-2 unit).</li>
<li>This means there is an <strong>interaction</strong> between an <strong>observed</strong> level-1 variable (e.g., household income) and an <strong>unobserved</strong> level-2 variable (e.g., <em>something</em> that differs between countries).</li>
<li>We can make these <em>latent</em> interactions <em>manifest</em> by specifying cross-level interactions, as we’ll see in a bit.</li>
<li>We may have better luck examining these with a larger data set.</li>
</ul>
</section>
<section id="switching-to-the-larger-dataset" class="slide level2">
<h2>Switching to the larger dataset</h2>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="kw">data</span>/ess_bigger_imp.dta, <span class="kw">clear</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="kw">rename</span> gnipc1000 gni</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> v <span class="kw">of</span> <span class="kw">varlist</span> eduyrs agea attend health inc gni {</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">qui</span> <span class="kw">sum</span> <span class="ot">`v'</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">gen</span> <span class="ot">`v'</span>01 = (<span class="ot">`v'</span> - <span class="ot">`r(min)'</span>) / (<span class="ot">`r(max)'</span> - <span class="ot">`r(min)'</span>)</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>la <span class="kw">var</span> stflife <span class="st">"Life Satisfaction"</span></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>la <span class="kw">var</span> eduyrs01 <span class="st">"Education"</span></span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>la <span class="kw">var</span> agea01 <span class="st">"Age"</span></span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>la <span class="kw">var</span> attend01 <span class="st">"Attendance"</span></span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>la <span class="kw">var</span> health01 <span class="st">"Health"</span></span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a>la <span class="kw">var</span> inc01 <span class="st">"Income"</span></span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a>la <span class="kw">var</span> female <span class="st">"Female"</span></span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a>la <span class="kw">var</span> gni01 <span class="st">"GNI pc"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>

<aside><div>
<p>I’m just redoing the steps we did on the smaller dataset: rescaling and adding labels.</p>
</div></aside></section>
<section id="respecify-models-in-full-sample" class="slide level2">
<h2>Respecify models in full sample</h2>
<div class="cell" data-execution_count="43">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>  <span class="co">// no variable slope</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> mixed stflife *01 c.agea01#c.agea01 || country:</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> mlmrsq</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a><span class="kw">est</span> <span class="kw">store</span> M2</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">// variable slope</span></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> mixed stflife *01 c.agea01#c.agea01 || country: inc01, cov(uns)</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> mlmrsq</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a><span class="kw">est</span> <span class="kw">store</span> M3</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">// compare fits</span></span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a><span class="kw">est</span> <span class="kw">stats</span> M2 M3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Akaike's information criterion and Bayesian information criterion

-----------------------------------------------------------------------------
       Model |          N   ll(null)  ll(model)      df        AIC        BIC
-------------+---------------------------------------------------------------
          M2 |     43,312          .  -91378.95      10   182777.9   182864.7
          M3 |     43,312          .  -91295.06      12   182614.1   182718.2
-----------------------------------------------------------------------------
Note: BIC uses N = number of observations. See [R] IC note.</code></pre>
</div>
</div>
<p>In the full sample, both AIC and BIC prefer a variable slope for <code>inc01</code>.</p>
</section>
<section id="section-4" class="slide level2">
<h2></h2>
<div class="cell" data-execution_count="44">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="kw">predict</span> m3_re*, <span class="kw">reffects</span>  <span class="co">// get RE BLUPS for slope and intercept</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> b_inc = _b[inc01]  <span class="co">// get slope for later</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> margins, atmeans <span class="fu">at</span>(inc01=0) <span class="kw">post</span>  <span class="co">// post to get correct intercept</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> yhat_M3 = _b[<span class="dt">_cons</span>] + m3_re2 + (<span class="ot">`b_inc'</span>+m3_re1)*inc01</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>spagplot yhat_M3 inc01, id(country) noover <span class="kw">note</span>(<span class="st">""</span>)</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>cap <span class="kw">qui</span> <span class="kw">gr</span> <span class="kw">export</span> <span class="st">"images/varincslope_full.pdf"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="slides_files/figure-revealjs/cell-45-output-1.svg" class="r-stretch"></section>
<section id="cross-level-interactions-finding-the-latent-moderator" class="slide level2">
<h2>Cross-level interactions: finding the latent moderator</h2>
<ul>
<li>As mentioned earlier, variable slopes come from an interaction between a <em>known</em> level-1 variable and an <em>unknown</em> level-2 variable.</li>
<li>In other words, <em>something</em> about countries is moderating the effect of income. The multilevel structure of the data allows us to see that, but not to know why.</li>
<li>This is a form of <em>treatment heterogeneity</em>.</li>
</ul>
<p>Let’s see if there’s any evidence that GNI per capita moderates the effect of income.</p>
</section>
<section id="gni-and-income" class="slide level2">
<h2>GNI and income</h2>
<p>We can add the interaction term and see if it improves model fit.</p>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> mixed stflife *01 c.agea01#c.agea01 c.gni01#c.inc01 <span class="co">/// last variable is cross-level interaction</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>  || country: inc01, cov(uns)</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> mlmrsq</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a><span class="kw">est</span> <span class="kw">store</span> M4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can also try to <em>replace</em> the variable slope with a cross-level interaction if we think it <em>fully</em> accounts for the heterogeneity in effect.</p>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> mixed stflife *01 c.agea01#c.agea01 c.gni01#c.inc01 || country:</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> mlmrsq</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="kw">est</span> <span class="kw">store</span> M5</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="model-fit" class="slide level2">
<h2>Model fit</h2>
<div class="cell" data-execution_count="47">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="kw">est</span> <span class="kw">stats</span> M3 M4 M5</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Akaike's information criterion and Bayesian information criterion

-----------------------------------------------------------------------------
       Model |          N   ll(null)  ll(model)      df        AIC        BIC
-------------+---------------------------------------------------------------
          M3 |     43,312          .  -91295.06      12   182614.1   182718.2
          M4 |     43,312          .  -91288.36      13   182602.7   182715.5
          M5 |     43,312          .  -91334.43      11   182690.9   182786.3
-----------------------------------------------------------------------------
Note: BIC uses N = number of observations. See [R] IC note.</code></pre>
</div>
</div>
<p>The model with the cross-level interaction (<code>M4</code>) is an improvement over the model with just the variable slope (<code>M3</code>). Unfortunately, we see that the model that removes the variable slope (<code>M5</code>) fits worse. This means that the cross-level interaction we specified cannot <em>fully</em> account for the variability in the slope of <code>inc01</code>.</p>
</section>
<section id="model-comparison" class="slide level2">
<h2>Model comparison</h2>
<div class="cell" data-execution_count="48">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>esttab M3 M4 M5, <span class="kw">keep</span>(<span class="ot">`e(depvar)'</span>:) b(3) t(2) <span class="kw">wide</span> <span class="kw">compress</span> <span class="co">///</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>  nodepvar <span class="fu">abs</span> nonumbers <span class="co">///</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>  interaction(<span class="st">" x "</span>) nostar varwidth(10) <span class="kw">label</span> <span class="co">///</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">stats</span>(N_l2 <span class="kw">N</span> br_rsq_l2 br_rsq_l1 br_rsq_to aic bic, <span class="co">///</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">label</span>(<span class="st">"N: Level 2"</span> <span class="st">"N: Level 1"</span> <span class="st">"R2 Between"</span> <span class="co">/// </span></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"R2 Within"</span> <span class="st">"R2 Total"</span> <span class="st">"AIC"</span> <span class="st">"BIC"</span>) <span class="co">///</span></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>    fmt(%7.0f %7.0f %7.3g %7.3g %7.3g %7.1f)) <span class="co">///</span></span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>    mtitle(<span class="st">"RS only"</span> <span class="st">"RS+CLI"</span> <span class="st">"CLI only"</span>) <span class="co">///</span></span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>    eqlabels(<span class="kw">none</span>) <span class="kw">order</span>(<span class="dt">_cons</span> eduyrs01 agea01 c.agea01#c.agea01) <span class="co">///</span></span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>    varlabel(<span class="dt">_cons</span> Constant) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
----------------------------------------------------------------------
             RS only              RS+CLI            CLI only          
----------------------------------------------------------------------
Constant       3.668   (20.65)     3.313   (17.44)     3.296   (19.91)
Education      0.070    (1.17)     0.069    (1.17)     0.073    (1.23)
Age           -3.249   (16.30)    -3.237   (16.24)    -3.270   (16.41)
Age x Age      5.466   (22.73)     5.452   (22.67)     5.490   (22.85)
Attendance     0.579   (13.81)     0.579   (13.82)     0.583   (13.91)
Health         2.712   (55.64)     2.711   (55.63)     2.715   (55.65)
Income         1.436   (14.80)     1.832   (14.79)     1.848   (33.48)
GNI pc         2.265    (5.78)     3.500    (7.12)     3.520    (8.36)
GNI pc x~e                        -1.373    (4.11)    -1.376    (9.44)
----------------------------------------------------------------------
N: Level 2        29                  29                  29          
N: Level 1     43312               43312               43312          
R2 Between      .734                .732                .732          
R2 Within       .134                .136                .136          
R2 Total        .239                 .24                 .24          
AIC         182614.1            182602.7            182690.9          
BIC         182718.2            182715.5            182786.3          
----------------------------------------------------------------------
Absolute t statistics in parentheses</code></pre>
</div>
</div>
</section>
<section id="random-slopes-clis-and-statistical-significance" class="slide level2">
<h2>Random slopes, CLIs, and “statistical significance”</h2>

<img data-src="images/RS-CLI-paper.png" width="350" class="r-stretch quarto-figure-center"><p>If you’re checking the “statistical significance” of a cross-level interaction, you <em>must</em> include random slopes on the level-1 variable that’s involved. In the previous slide, look how different the z-ratios are between the two models with CLIs. If you use BIC (or AIC) to choose models, this doesn’t matter!</p>
</section>
<section id="summary" class="slide level2">
<h2>Summary</h2>
<ul>
<li>Only level-1 variance in predictors can “explain” level-1 variance in the outcome</li>
<li>Only level-2 variance in predictors can “explain” level-2 variance in the outcome</li>
<li>Only cross-level interactions can “explain” random (varying) slopes between groups</li>
<li>This is why it’s essential to know where your variance is!</li>
</ul>
</section>
<section id="additional-assumptions-of-random-intercept-models" class="slide level2">
<h2>Additional assumptions of random intercept models</h2>
<ul>
<li>Partial pooling is only half the story of “random effects” (i.e., “mixed” or “multilevel”) models.</li>
<li>The rest is about what these models assume about the relationship between the random intercepts ( <span class="math inline">\(\alpha_j\)</span> ) and the predictors in the model.</li>
</ul>
</section>
<section id="assumptions-in-standard-linear-regression" class="slide level2">
<h2>Assumptions in standard linear regression</h2>
<p><span class="math display">\[y_i = \mu + \beta x_{i} + \epsilon_{i}\]</span></p>
<p>If we want to interpret <span class="math inline">\(\beta\)</span> as unbiased, we need to assume that <span class="math inline">\(x_i\)</span> and <span class="math inline">\(\epsilon_i\)</span> are independent.</p>
</section>
<section id="extension-to-mixed-models" class="slide level2">
<h2>Extension to mixed models</h2>
<p><span class="math display">\[y_{ij} = \mu + \beta x_{ij} + \alpha_j + \epsilon_{ij}\]</span></p>
<p>Mixed models partition the total error into group- and individual-level components. But the same assumptions apply to both parts: that <span class="math inline">\(x_{ij}\)</span> is independent of <span class="math inline">\(\alpha_j\)</span> and <span class="math inline">\(\epsilon_{ij}\)</span>.</p>
</section>
<section id="pros-and-cons-of-the-assumption" class="slide level2">
<h2>Pros and cons of the assumption</h2>
<ul>
<li>This <em>random effects</em> assumption allows combining within and between variance to estimate parameters.</li>
<li>It allows a principled way to combine data from small and large clusters.</li>
<li>BUT, it requires the assumption that the within and between variance have the <em>same effects</em> on the outcome.</li>
<li>For example, does <em>living in a more religious country</em> have the same effect on the outcome as being a <em>more religious person than average</em> in your country?</li>
<li>That is, do <span class="math inline">\(\overline{attend01}_j\)</span> and <span class="math inline">\((attend01_{ij} - \overline{attend01}_j)\)</span> have the same effect on life satisfaction?</li>
</ul>
</section>
<section id="this-assumption-is-testable-with-multilevel-data" class="slide level2">
<h2>This assumption is testable with multilevel data</h2>
<ul>
<li>Unlike with OLS where the assumption is inherently untestable, multilevel data allows us to test the independence of <span class="math inline">\(\alpha_j\)</span> and <span class="math inline">\(\mathbf{X_{ij}}\)</span>.</li>
<li>The traditional test in social science is the <strong>Hausman test</strong>, which tests the equivalence of the mixed model estimates and the <em>within-only</em> estimates of the <span class="math inline">\(\beta\)</span> coefficients.</li>
<li>The within estimates (often called <em>fixed-effects</em> estimates) use <em>only</em> the within-group variance to estimate <span class="math inline">\(\beta\)</span> coefficients.</li>
<li>This is equivalent to using a <em>no-pooling</em> assumption for the intercepts (i.e., removing the mean for each group) and a <em>complete-pooling</em> assumption for each <span class="math inline">\(\beta\)</span> (i.e., assuming there is one effect for each variable).</li>
</ul>
</section>
<section id="the-within-fixed-effects-model" class="slide level2">
<h2>The within / fixed-effects model</h2>
<p><span class="math inline">\(y_{ij} = \mu + \beta x_{ij} + \alpha_j + \epsilon_{ij}\)</span>, where <span class="math inline">\(\alpha_j\)</span> is measured as a set of <span class="math inline">\(J-1\)</span> dummy variables.</p>
<p>Or…</p>
<p><span class="math inline">\(y_{ij} - \bar{y}_j = \beta(x_{ij} - \bar{x}_j) + (\epsilon_{ij} - \bar{\epsilon}_j)\)</span></p>
<p>Through subtraction, this model “controls” for all pure level-2 characteristics with constant effects, whether observed or unobserved. It accomplishes this by discarding all between-group variance. This will matter <em>much more</em> in situations where level-2 variance is a bigger part of the outcome (e.g., most panel data).</p>
</section>
<section id="fixed-effects-models-with-xtreg-fe" class="slide level2">
<h2>Fixed-effects models with <code>xtreg, fe</code></h2>
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>  <span class="co">// the fe option gives fixed effects (within-only model)</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>eststo FE: <span class="kw">xtreg</span> stflife eduyrs01-inc01 c.agea01#c.agea01, i(country) <span class="kw">fe</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Fixed-effects (within) regression               Number of obs     =     43,312
Group variable: country                         Number of groups  =         29

R-squared:                                      Obs per group:
     Within  = 0.1341                                         min =        578
     Between = 0.6262                                         avg =    1,493.5
     Overall = 0.1608                                         max =      2,552

                                                F(6, 43277)       =    1116.70
corr(u_i, Xb) = 0.1626                          Prob &gt; F          =     0.0000

-----------------------------------------------------------------------------------
          stflife | Coefficient  Std. err.      t    P&gt;|t|     [95% conf. interval]
------------------+----------------------------------------------------------------
         eduyrs01 |   .0726357   .0594519     1.22   0.222     -.043891    .1891625
           agea01 |  -3.392044    .199079   -17.04   0.000    -3.782243   -3.001845
         attend01 |   .5806636   .0419621    13.84   0.000     .4984171    .6629101
         health01 |    2.71984   .0488485    55.68   0.000     2.624096    2.815584
            inc01 |   1.444699   .0350126    41.26   0.000     1.376074    1.513325
                  |
c.agea01#c.agea01 |   5.622828   .2401287    23.42   0.000     5.152171    6.093485
                  |
            _cons |   4.304934   .0641686    67.09   0.000     4.179163    4.430706
------------------+----------------------------------------------------------------
          sigma_u |  .85096544
          sigma_e |  1.9925059
              rho |  .15426245   (fraction of variance due to u_i)
-----------------------------------------------------------------------------------
F test that all u_i=0: F(28, 43277) = 260.86                 Prob &gt; F = 0.0000</code></pre>
</div>
</div>
</section>
<section id="simple-re-models-with-xtreg-mle" class="slide level2">
<h2><em>Simple</em> RE models with <code>xtreg, mle</code></h2>
<div class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>  <span class="co">// the mle option gives random effects estimated with maximum likelihood</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>eststo RE: <span class="kw">xtreg</span> stflife eduyrs01-inc01 c.agea01#c.agea01 gni01, i(country) <span class="kw">mle</span> <span class="kw">nolog</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Random-effects ML regression                        Number of obs    =  43,312
Group variable: country                             Number of groups =      29

Random effects u_i ~ Gaussian                       Obs per group:
                                                                 min =     578
                                                                 avg = 1,493.5
                                                                 max =   2,552

                                                    LR chi2(7)       = 6268.51
Log likelihood = -91378.954                         Prob &gt; chi2      =  0.0000
</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>-----------------------------------------------------------------------------------
          stflife | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]
------------------+----------------------------------------------------------------
         eduyrs01 |   .0750536   .0594238     1.26   0.207    -.0414149     .191522
           agea01 |   -3.39292    .199054   -17.05   0.000    -3.783059   -3.002782
         attend01 |   .5800559   .0419275    13.83   0.000     .4978794    .6622323
         health01 |   2.721402   .0488294    55.73   0.000     2.625699    2.817106
            inc01 |   1.444603   .0349967    41.28   0.000      1.37601    1.513195
                  |
c.agea01#c.agea01 |   5.624795   .2400992    23.43   0.000     5.154209    6.095381
                  |
            gni01 |   2.879253   .4140915     6.95   0.000     2.067649    3.690857
            _cons |   3.491182   .1637586    21.32   0.000     3.170221    3.812143
------------------+----------------------------------------------------------------</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>         /sigma_u |   .5089991   .0675991                      .3923474    .6603335
         /sigma_e |   1.992368   .0067717                       1.97914    2.005684
              rho |   .0612684   .0152819                       .036601    .0973403
-----------------------------------------------------------------------------------
LR test of sigma_u=0: chibar2(01) = 2621.35            Prob &gt;= chibar2 = 0.000</code></pre>
</div>
</div>
</section>
<section id="comparing-models" class="slide level2">
<h2>Comparing models</h2>
<div class="cell" data-execution_count="51">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>esttab RE FE, b(3) t(2) <span class="kw">wide</span> <span class="kw">compress</span> <span class="co">///</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>  nodepvar <span class="fu">abs</span> nonumbers <span class="co">///</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>  interaction(<span class="st">" x "</span>) nostar varwidth(16) <span class="kw">label</span> <span class="co">///</span></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">noobs</span> <span class="co">///</span></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>  mtitle(<span class="st">"Mixed/RE"</span> <span class="st">"Fixed"</span>) <span class="co">///</span></span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>  eqlabels(<span class="kw">none</span>) <span class="co">///</span></span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">order</span>(<span class="dt">_cons</span> eduyrs01 agea01 c.agea01#c.agea01) <span class="co">///</span></span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">note</span>(<span class="st">""</span>) varlabel(<span class="dt">_cons</span> Constant) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
--------------------------------------------------------
                  Mixed/RE               Fixed          
--------------------------------------------------------
Constant             3.491   (21.32)     4.305   (67.09)
Education            0.075    (1.26)     0.073    (1.22)
Age                 -3.393   (17.05)    -3.392   (17.04)
Age x Age            5.625   (23.43)     5.623   (23.42)
Attendance           0.580   (13.83)     0.581   (13.84)
Health               2.721   (55.73)     2.720   (55.68)
Income               1.445   (41.28)     1.445   (41.26)
GNI pc               2.879    (6.95)                    
sigma_u              0.509    (7.53)                    
sigma_e              1.992  (294.22)                    
--------------------------------------------------------
</code></pre>
</div>
</div>
<p>There are no real substantive differences here. But this isn’t a formal test of the equivalence of the coefficients.</p>
</section>
<section id="hausman-test" class="slide level2">
<h2>Hausman test</h2>
<div class="cell" data-execution_count="52">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="kw">hausman</span> FE RE, <span class="kw">eq</span>(1:1) sigmaless <span class="co">// eq tells it which equations to match; look at help file to understand sigmaless</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
                 ---- Coefficients ----
             |      (b)          (B)            (b-B)     sqrt(diag(V_b-V_B))
             |       FE           RE         Difference       Std. err.
-------------+----------------------------------------------------------------
    eduyrs01 |    .0726357     .0750536       -.0024178        .0016876
      agea01 |   -3.392044     -3.39292        .0008764        .0021143
    attend01 |    .5806636     .5800559        .0006077        .0016299
    health01 |     2.71984     2.721402       -.0015627        .0012399
       inc01 |    1.444699     1.444603        .0000967        .0009723
    c.agea01#|
    c.agea01 |    5.622828     5.624795       -.0019668         .002481
------------------------------------------------------------------------------
                          b = Consistent under H0 and Ha; obtained from xtreg.
           B = Inconsistent under Ha, efficient under H0; obtained from xtreg.

Test of H0: Difference in coefficients not systematic

    chi2(6) = (b-B)'[(V_b-V_B)^(-1)](b-B)
            =  20.95
Prob &gt; chi2 = 0.0019</code></pre>
</div>
</div>
<p>The null of equal coefficients is rejected. But the test is likely overpowered with such a large sample.</p>
</section>
<section id="a-a-more-flexible-option" class="slide level2">
<h2>A a more flexible option</h2>
<p>This model is sometimes called the “between-within” or “hybrid” model.</p>
<p><span class="math display">\[y_{ij} = \mu + \beta(x_{ij} - \bar{x}_j) + \gamma \bar{x}_j + \alpha_j + \epsilon_{ij}\]</span></p>
<p>The model is just an “ordinary” mixed model, but it splits all variables with level-1 variance into two variables: a <em>within</em> variable and a <em>between</em> variable.</p>

<aside><div>
<p>See Allison (2009). <a href="https://www.google.com/books/edition/Fixed_Effects_Regression_Models/3UxaBQAAQBAJ?kptab=getbook"><em>Fixed Effects Regression Models</em></a>.</p>
</div></aside></section>
<section id="data-preparation" class="slide level2">
<h2>Data preparation</h2>
<p>This loop will make two new variables: one version that is just the cluster means (<code>m_*</code>) and one that is just the cluster differences (<code>d_*</code>).</p>
<div class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> v <span class="kw">of</span> <span class="kw">varlist</span> eduyrs01 - inc01 {</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">bysort</span> country: <span class="kw">egen</span> m_<span class="ot">`v'</span> = <span class="kw">mean</span>(<span class="ot">`v'</span>)</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">gen</span> d_<span class="ot">`v'</span> = <span class="ot">`v'</span> - m_<span class="ot">`v'</span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a> }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="two-options-cre-and-bw" class="slide level2">
<h2>Two options: CRE and BW</h2>
<p>As long as the mean variables (<code>m_*</code> variables) are in the model, you can use the original variables in lieu of the difference variables (<code>d_*</code>) to get the within estimates.</p>
<p><strong>However</strong>, this changes the interpretation of the <code>m_*</code> variables. If you use the original variables, the <code>m_*</code> variable coefficients now reflect how <em>different</em> the between effects are from the within effects (see next slide). This is called the <strong>correlated random effects</strong> (CRE) model.</p>
<p>If you use the <code>d_*</code> variables, this is called the <strong>between-within</strong> (BW) model. Both fit equally well.</p>

<aside><div>
<p>See Schunck and Perales. 2017. <a href="https://journals.sagepub.com/doi/pdf/10.1177/1536867X1701700106">“Within- and Between-Cluster Effects in Generalized Linear Mixed Models.”</a> <em>The Stata Journal</em> 17(1):89–115.</p>
</div></aside></section>
<section id="bw-and-cre-compared" class="slide level2">
<h2>BW and CRE compared</h2>
<h4 id="between-within-or-hybrid">Between-within or “hybrid”</h4>
<p><span class="math display">\[y_{ij} = \mu + \beta_W(x_{ij} - \bar{x}_j) + \beta_B \bar{x}_j + \alpha_j + \epsilon_{ij}\]</span></p>
<h4 id="correlated-random-effects">Correlated random effects</h4>
<p><span class="math display">\[y_{ij} = \mu + \beta_W x_{ij} + \beta_C \bar{x}_j + \alpha_j + \epsilon_{ij}\]</span></p>
<h4 id="comparison">Comparison</h4>
<p><span class="math display">\[\beta_W + \beta_C = \beta_B\]</span></p>

<aside><div>
<p><span class="math inline">\(\beta_C\)</span> is sometimes called the “contextual” effect because it tells you how <em>different</em> the between-group effect of a variable is from its within-group effect.</p>
</div></aside></section>
<section id="model-syntax-cre" class="slide level2">
<h2>Model syntax (CRE)</h2>
<div class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> mixed stflife eduyrs01-inc01 c.agea01#c.agea01 <span class="co">/// L1 variables</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>  m_* c.m_agea01#c.m_agea01 gni01                  <span class="co">/// L2 variables</span></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>  || country:                                      <span class="co">//  Random Intercept     </span></span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> mlmrsq</span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a><span class="kw">est</span> <span class="kw">store</span> CRE</span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">// labels</span></span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a>la <span class="kw">var</span> m_eduyrs01 <span class="st">"Mean Educ."</span></span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a>la <span class="kw">var</span> m_agea01 <span class="st">"Mean Age"</span></span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a>la <span class="kw">var</span> m_attend01 <span class="st">"Mean Attend."</span></span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a>la <span class="kw">var</span> m_health <span class="st">"Mean Health"</span></span>
<span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a>la <span class="kw">var</span> m_inc <span class="st">"Mean Inc. Dec."</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="fe-and-cre-within-estimates-are-identical" class="slide level2">
<h2>FE and CRE <em>within</em> estimates are identical</h2>
<div class="cell" data-execution_count="55">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>esttab CRE FE, b(3) t(2) <span class="kw">wide</span> <span class="kw">compress</span> <span class="co">///</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>  nodepvar <span class="fu">abs</span> nonumbers <span class="co">///</span></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>  interaction(<span class="st">" x "</span>) nostar varwidth(16) <span class="kw">label</span> <span class="co">///</span></span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">noobs</span> <span class="co">///</span></span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>  mtitle(<span class="st">"CRE"</span> <span class="st">"xtreg, fe"</span>) <span class="co">///</span></span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>  eqlabels(<span class="kw">none</span>) <span class="co">///</span></span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">order</span>(<span class="dt">_cons</span> eduyrs01 agea01 c.agea01#c.agea01) <span class="co">///</span></span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a>  varlabel(<span class="dt">_cons</span> Constant) <span class="kw">drop</span>(lns*: ) <span class="kw">note</span>(<span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
--------------------------------------------------------
                       CRE           xtreg, fe          
--------------------------------------------------------
Constant            -6.709    (0.49)     4.305   (67.09)
Education            0.073    (1.22)     0.073    (1.22)
Age                 -3.394   (17.05)    -3.392   (17.04)
Age x Age            5.625   (23.43)     5.623   (23.42)
Attendance           0.581   (13.84)     0.581   (13.84)
Health               2.720   (55.68)     2.720   (55.68)
Income               1.445   (41.27)     1.445   (41.26)
Mean Educ.           0.995    (0.55)                    
Mean Age            37.537    (0.53)                    
Mean Attend.        -1.193    (1.16)                    
Mean Health          4.510    (2.37)                    
Mean Inc. Dec.       1.319    (0.94)                    
Mean Age x Mea~e   -53.349    (0.59)                    
GNI pc               1.738    (2.99)                    
--------------------------------------------------------
</code></pre>
</div>
</div>
</section>
<section id="model-comparison-1" class="slide level2">
<h2>Model comparison</h2>
<div class="cell" data-execution_count="56">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>esttab M3 CRE, <span class="kw">keep</span>(<span class="ot">`e(depvar)'</span>:) b(3) t(2) <span class="kw">wide</span> <span class="kw">compress</span> <span class="co">///</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>  nodepvar <span class="fu">abs</span> nonumbers <span class="co">///</span></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>  interaction(<span class="st">" x "</span>) nostar varwidth(16) <span class="kw">label</span> <span class="co">///</span></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">stats</span>(N_l2 <span class="kw">N</span> br_rsq_l2 br_rsq_l1 br_rsq_to aic bic, <span class="co">///</span></span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">label</span>(<span class="st">"N: Level 2"</span> <span class="st">"N: Level 1"</span> <span class="st">"R2 Between"</span> <span class="co">/// </span></span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"R2 Within"</span> <span class="st">"R2 Total"</span> <span class="st">"AIC"</span> <span class="st">"BIC"</span>) <span class="co">///</span></span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>    fmt(%7.0f %7.0f %7.3g %7.3g %7.3g %7.1f))  <span class="co">///</span></span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>  mtitle(<span class="st">"Mixed"</span> <span class="st">"CRE"</span>) <span class="co">///</span></span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a>  eqlabels(<span class="kw">none</span>) <span class="co">///</span></span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">order</span>(<span class="dt">_cons</span> eduyrs01 agea01 c.agea01#c.agea01) <span class="kw">note</span>(<span class="st">""</span>) <span class="co">///</span></span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a>  varlabel(<span class="dt">_cons</span> Constant)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
--------------------------------------------------------
                     Mixed                 CRE          
--------------------------------------------------------
Constant             3.668   (20.65)    -6.709    (0.49)
Education            0.070    (1.17)     0.073    (1.22)
Age                 -3.249   (16.30)    -3.394   (17.05)
Age x Age            5.466   (22.73)     5.625   (23.43)
Attendance           0.579   (13.81)     0.581   (13.84)
Health               2.712   (55.64)     2.720   (55.68)
Income               1.436   (14.80)     1.445   (41.27)
GNI pc               2.265    (5.78)     1.738    (2.99)
Mean Educ.                               0.995    (0.55)
Mean Age                                37.537    (0.53)
Mean Attend.                            -1.193    (1.16)
Mean Health                              4.510    (2.37)
Mean Inc. Dec.                           1.319    (0.94)
Mean Age x Mea~e                       -53.349    (0.59)
--------------------------------------------------------
N: Level 2              29                  29          
N: Level 1           43312               43312          
R2 Between            .734                .809          
R2 Within             .134                .134          
R2 Total              .239                .252          
AIC               182614.1            182780.3          
BIC               182718.2            182919.2          
--------------------------------------------------------
</code></pre>
</div>
</div>
</section>
<section id="the-cre-is-more-flexible-than-the-refe-choice" class="slide level2">
<h2>The CRE is more flexible than the RE/FE choice</h2>
<div class="cell" data-execution_count="57">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>  <span class="co">// all L1 variable means included</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> mixed stflife eduyrs01-inc01 c.agea01#c.agea01 <span class="co">/// Level 1</span></span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>                  m_* gni01                        <span class="co">/// Level 2</span></span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>                          c.inc01#c.gni01                  <span class="co">/// Cross-level</span></span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>                  || country: inc01, cov(uns)      <span class="co">//  Random int. and income slope </span></span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> mlmrsq</span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a><span class="kw">est</span> <span class="kw">store</span> CRE1</span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">// only health01 has original and mean included</span></span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> mixed stflife eduyrs01-inc01 c.agea01#c.agea01 <span class="co">/// Level 1</span></span>
<span id="cb113-13"><a href="#cb113-13" aria-hidden="true" tabindex="-1"></a>                  m_health01 gni01                 <span class="co">/// Level 2</span></span>
<span id="cb113-14"><a href="#cb113-14" aria-hidden="true" tabindex="-1"></a>                            c.inc01#c.gni01                  <span class="co">/// Cross-level</span></span>
<span id="cb113-15"><a href="#cb113-15" aria-hidden="true" tabindex="-1"></a>                  || country: inc01, cov(uns)      <span class="co">//  Random int. and income slope </span></span>
<span id="cb113-16"><a href="#cb113-16" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> mlmrsq</span>
<span id="cb113-17"><a href="#cb113-17" aria-hidden="true" tabindex="-1"></a><span class="kw">est</span> <span class="kw">store</span> CRE2</span>
<span id="cb113-18"><a href="#cb113-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-19"><a href="#cb113-19" aria-hidden="true" tabindex="-1"></a>esttab M4 CRE1 CRE2, <span class="kw">keep</span>(<span class="ot">`e(depvar)'</span>:) b(3) t(2) <span class="kw">wide</span> <span class="kw">compress</span> <span class="co">///</span></span>
<span id="cb113-20"><a href="#cb113-20" aria-hidden="true" tabindex="-1"></a>  nodepvar <span class="fu">abs</span> nonumbers <span class="co">///</span></span>
<span id="cb113-21"><a href="#cb113-21" aria-hidden="true" tabindex="-1"></a>  interaction(<span class="st">" x "</span>) nostar varwidth(16) <span class="kw">label</span> <span class="co">///</span></span>
<span id="cb113-22"><a href="#cb113-22" aria-hidden="true" tabindex="-1"></a><span class="kw">stats</span>(N_l2 <span class="kw">N</span> br_rsq_l2 br_rsq_l1 br_rsq_to aic bic, <span class="co">///</span></span>
<span id="cb113-23"><a href="#cb113-23" aria-hidden="true" tabindex="-1"></a>  <span class="kw">label</span>(<span class="st">"N: Level 2"</span> <span class="st">"N: Level 1"</span> <span class="st">"R2 Between"</span> <span class="co">/// </span></span>
<span id="cb113-24"><a href="#cb113-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"R2 Within"</span> <span class="st">"R2 Total"</span> <span class="st">"AIC"</span> <span class="st">"BIC"</span>) <span class="co">///</span></span>
<span id="cb113-25"><a href="#cb113-25" aria-hidden="true" tabindex="-1"></a>  fmt(%7.0f %7.0f %7.3g %7.3g %7.3g %7.1f))  <span class="co">///</span></span>
<span id="cb113-26"><a href="#cb113-26" aria-hidden="true" tabindex="-1"></a>mtitle(<span class="st">"Mixed"</span> <span class="st">"full CRE"</span> <span class="st">"part CRE"</span>) <span class="co">///</span></span>
<span id="cb113-27"><a href="#cb113-27" aria-hidden="true" tabindex="-1"></a>varlabel(<span class="dt">_cons</span> Constant) eqlabels(<span class="kw">none</span>) <span class="co">///</span></span>
<span id="cb113-28"><a href="#cb113-28" aria-hidden="true" tabindex="-1"></a><span class="kw">order</span>(Constant eduyrs01 agea01 c.agea01#c.agea01) <span class="kw">note</span>(<span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
----------------------------------------------------------------------------
                     Mixed            full CRE            part CRE          
----------------------------------------------------------------------------
Education            0.069    (1.17)     0.068    (1.14)     0.069    (1.16)
Age                 -3.237   (16.24)    -3.239   (16.24)    -3.240   (16.25)
Age x Age            5.452   (22.67)     5.452   (22.67)     5.454   (22.68)
Attendance           0.579   (13.82)     0.581   (13.85)     0.578   (13.80)
Health               2.711   (55.63)     2.710   (55.57)     2.709   (55.56)
Income               1.832   (14.79)     1.837   (14.83)     1.838   (14.85)
GNI pc               3.500    (7.12)     2.562    (4.16)     3.020    (5.49)
GNI pc x Income     -1.373    (4.11)    -1.381    (4.14)    -1.382    (4.14)
Mean Educ.                               0.643    (0.36)                    
Mean Age                                -3.590    (1.07)                    
Mean Attend.                            -1.711    (1.68)                    
Mean Health                              3.770    (2.01)     2.854    (1.63)
Mean Inc. Dec.                           0.662    (0.49)                    
Constant             3.313   (17.44)     2.111    (1.00)     1.471    (1.28)
----------------------------------------------------------------------------
N: Level 2              29                  29                  29          
N: Level 1           43312               43312               43312          
R2 Between            .732                .804                .764          
R2 Within             .136                .136                .136          
R2 Total               .24                .253                .246          
AIC               182602.7            182605.8            182602.3          
BIC               182715.5            182762.0            182723.8          
----------------------------------------------------------------------------
</code></pre>
</div>
</div>
</section>
<section id="possible-pitfalls" class="slide level2">
<h2>Possible pitfalls</h2>
<ul>
<li>As noted, it doesn’t affect overall model fit if you use the original variables <span class="math inline">\(x_{ij}\)</span> or the difference variables <span class="math inline">\(x_{ij} - \bar{x}_{j}\)</span> in addition to the mean variables, <span class="math inline">\(\bar{x}_{j}\)</span>.</li>
<li>As noted above, this <strong>does</strong> change the interpretation of the <code>m_*</code> variables.</li>
<li>However, it is vital <strong>NOT</strong> to use just the difference variables alone. This is equivalent to assuming the that the between-group variance has no effect on the outcome, which is is almost never the case!</li>
</ul>
</section>
<section id="principled-model-comparison" class="slide level2">
<h2>Principled model comparison</h2>
<ul>
<li>Note that above, decoupling the within and between variation in the <span class="math inline">\(\mathbf{X_{ij}}\)</span> variables substantially reduced the country-level variance compared to the simple mixed model. But this comes at the cost of added complexity (i.e., 2 variables each instead of 1).</li>
<li>The simpler model seems better here because it is less likely to have overfit the data. And recall that only 17% of the variance is at the country level to begin with.</li>
</ul>
</section>
<section id="what-model-should-i-use" class="slide level2">
<h2>What model should I use?</h2>
<p>It really depends on your <strong>research question</strong>. If you are not interested in level-2 effects at all, estimating a within/FE model is the more “conservative” option. This happens a lot in (e.g.) economics and political science where a researcher might use state- or county-level fixed effects in a model where individual characteristics are of primary concern.</p>
<p>There are no one-size-fits-all answers!</p>
</section></section>
<section>
<section id="three-level-models" class="title-slide slide level1 center">
<h1>Three-level models</h1>

</section>
<section id="the-equation" class="slide level2">
<h2>The equation</h2>
<p><span class="math display">\[y_{ijk} = \mu + \alpha_{k} + \eta_{jk} + \epsilon_{ijk}\]</span></p>
<p>This (variance components) model just splits the variance into three pieces instead of two. The logic is identical. We will use the <code>region</code> variable in the ESS to demonstrate the syntax.</p>
</section>
<section id="syntax-in-mixed" class="slide level2">
<h2>Syntax in <code>mixed</code></h2>
<div class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>mixed stflife || country: || region: , <span class="kw">nolog</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Mixed-effects ML regression                             Number of obs = 43,312

        Grouping information
        -------------------------------------------------------------
                        |     No. of       Observations per group
         Group variable |     groups    Minimum    Average    Maximum
        ----------------+--------------------------------------------
                country |         29        578    1,493.5      2,552
                 region |        351          5      123.4      1,210
        -------------------------------------------------------------

                                                        Wald chi2(0)  =      .
Log likelihood = -94308.603                             Prob &gt; chi2   =      .

------------------------------------------------------------------------------
     stflife | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
       _cons |     6.7996   .1886671    36.04   0.000     6.429819     7.16938
------------------------------------------------------------------------------

------------------------------------------------------------------------------
  Random-effects parameters  |   Estimate   Std. err.     [95% conf. interval]
-----------------------------+------------------------------------------------
country: Identity            |</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                  var(_cons) |   1.006376   .2694969      .5954115    1.700995
-----------------------------+------------------------------------------------
region: Identity             |
                  var(_cons) |   .1300273   .0165459      .1013258    .1668589
-----------------------------+------------------------------------------------
               var(Residual) |   4.498262   .0307132      4.438466    4.558863
------------------------------------------------------------------------------
LR test vs. linear model: chi2(2) = 8584.63               Prob &gt; chi2 = 0.0000

Note: LR test is conservative and provided only for reference.</code></pre>
</div>
</div>
</section>
<section id="icc-for-three-levels" class="slide level2">
<h2>ICC for three levels</h2>
<div class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="kw">estat</span> icc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Intraclass correlation

------------------------------------------------------------------------------
                       Level |        ICC   Std. err.     [95% conf. interval]
-----------------------------+------------------------------------------------</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                     country |   .1786044   .0393018      .1139614    .2687915</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>              region|country |   .2016807   .0382707      .1368501    .2870113
------------------------------------------------------------------------------</code></pre>
</div>
</div>
</section>
<section id="adding-covariates" class="slide level2 smaller">
<h2>Adding covariates</h2>
<div class="cell" data-execution_count="60">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>mixed stflife eduyrs01-inc01 c.agea01#c.agea01   <span class="co">/// Level 1</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>  gni01                                          <span class="co">/// Level 2</span></span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>  c.inc01#c.gni01                                <span class="co">/// CLI</span></span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>  || country: inc01   || region: inc01, cov(uns) <span class="co">///  REs</span></span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">noheader</span> <span class="kw">nogroup</span> <span class="kw">nolog</span>                         <span class="co">// output options</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
-----------------------------------------------------------------------------------
          stflife | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]
------------------+----------------------------------------------------------------
         eduyrs01 |   .0888594   .0598754     1.48   0.138    -.0284943    .2062131
           agea01 |  -3.295683   .1985985   -16.59   0.000    -3.684929   -2.906437
         attend01 |    .572294   .0422284    13.55   0.000     .4895279    .6550602
         health01 |   2.687597   .0486706    55.22   0.000     2.592204    2.782989
            inc01 |    1.84294   .1160421    15.88   0.000     1.615502    2.070378
                  |
c.agea01#c.agea01 |    5.49472   .2395043    22.94   0.000       5.0253     5.96414
                  |
            gni01 |   3.514376   .4655805     7.55   0.000     2.601855    4.426897
                  |
  c.inc01#c.gni01 |  -1.383563   .3127058    -4.42   0.000    -1.996455   -.7706704
                  |
            _cons |   3.321949     .18084    18.37   0.000     2.967509    3.676389
-----------------------------------------------------------------------------------

------------------------------------------------------------------------------
  Random-effects parameters  |   Estimate   Std. err.     [95% conf. interval]
-----------------------------+------------------------------------------------
country: Independent         |
                  var(inc01) |   .0962382   .0381853      .0442189    .2094531</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                  var(_cons) |   .2989961   .0852202      .1710232    .5227281
-----------------------------+------------------------------------------------
region: Unstructured         |
                  var(inc01) |   .1391587   .0376534      .0818829    .2364982
                  var(_cons) |   .1771801   .0264788      .1321924     .237478
            cov(inc01,_cons) |  -.1403237   .0299895      -.199102   -.0815453
-----------------------------+------------------------------------------------
               var(Residual) |   3.887331   .0265929      3.835558    3.939803
------------------------------------------------------------------------------
LR test vs. linear model: chi2(5) = 3018.03               Prob &gt; chi2 = 0.0000

Note: LR test is conservative and provided only for reference.</code></pre>
</div>
</div>
</section></section>
<section>
<section id="binary-outcomes" class="title-slide slide level1 center">
<h1>Binary outcomes</h1>

</section>
<section id="mixed-logistic-regression" class="slide level2">
<h2>Mixed logistic regression</h2>
<ul>
<li>Most of the same concepts we have learned apply almost identically to logistic regression.</li>
<li>In fact, what makes this challenging is the weirdness of logistic regression rather than anything having to do with multilevel models!</li>
</ul>
<p><span class="math display">\[log \left( \frac{p}{1-p} \right) = \mu + \beta x_{ij} + \alpha_{j}\]</span></p>
<p><span class="math display">\[\alpha_j \sim N(0,\tau^2)\]</span></p>
</section>
<section id="main-pitfalls" class="slide level2">
<h2>Main pitfalls</h2>
<p>The main issue here is that all the parameters are in log-odds units rather than in units of the response.</p>
<p>Another issue is that (as in all logistic regression) the level-1 variance is assumed to be <span class="math inline">\(\pi^2/3\)</span>. So calculating the ICC follows the same formula but assumes <span class="math inline">\(\sigma^2 = \pi^2/3\)</span>.</p>
</section>
<section id="syntax" class="slide level2">
<h2>Syntax</h2>
<div class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> satisfied = stflife &gt;= 8</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>melogit satisfied || country: , <span class="kw">nolog</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Mixed-effects logistic regression               Number of obs     =     43,312
Group variable: country                         Number of groups  =         29

                                                Obs per group:
                                                              min =        578
                                                              avg =    1,493.5
                                                              max =      2,552

Integration method: mvaghermite                 Integration pts.  =          7

                                                Wald chi2(0)      =          .
Log likelihood = -26404.486                     Prob &gt; chi2       =          .</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>------------------------------------------------------------------------------
   satisfied | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
       _cons |  -.1058779   .1691694    -0.63   0.531    -.4374438     .225688
-------------+----------------------------------------------------------------</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>country      |</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   var(_cons)|   .8262975     .21816                      .4924943    1.386346
------------------------------------------------------------------------------
LR test vs. logistic model: chibar2(01) = 7105.33     Prob &gt;= chibar2 = 0.0000</code></pre>
</div>
</div>
</section>
<section id="iccvpc" class="slide level2">
<h2>ICC/VPC</h2>
<div class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="kw">estat</span> icc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Intraclass correlation

------------------------------------------------------------------------------
                       Level |        ICC   Std. err.     [95% conf. interval]
-----------------------------+------------------------------------------------
                     country</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> |   .2007445   .0423612      .1302081    .2964676
------------------------------------------------------------------------------</code></pre>
</div>
</div>
</section>
<section id="with-covariates" class="slide level2">
<h2>With covariates</h2>
<div class="cell" data-execution_count="64">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>melogit satisfied eduyrs01-inc01 c.agea01#c.agea01 gni01 || country: , <span class="kw">nolog</span> <span class="kw">noheader</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>-----------------------------------------------------------------------------------
        satisfied | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]
------------------+----------------------------------------------------------------
         eduyrs01 |  -.0427816   .0686363    -0.62   0.533    -.1773064    .0917431
           agea01 |  -2.750837   .2271286   -12.11   0.000    -3.196001   -2.305673
         attend01 |   .5401965    .047885    11.28   0.000     .4463436    .6340494
         health01 |   2.352441   .0586832    40.09   0.000     2.237424    2.467458
            inc01 |   1.304877   .0406205    32.12   0.000     1.225262    1.384492
                  |
c.agea01#c.agea01 |   4.878604   .2766388    17.64   0.000     4.336402    5.420806
                  |
            gni01 |   3.007544   .4284568     7.02   0.000     2.167784    3.847304
            _cons |  -3.179769   .1734774   -18.33   0.000    -3.519778   -2.839759
------------------+----------------------------------------------------------------
country           |
        var(_cons)|   .2759901   .0737762                      .1634386    .4660498
-----------------------------------------------------------------------------------
LR test vs. logistic model: chibar2(01) = 1908.71     Prob &gt;= chibar2 = 0.0000</code></pre>
</div>
</div>
</section>
<section id="with-odds-ratios" class="slide level2">
<h2>With odds ratios</h2>
<div class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>melogit, <span class="kw">or</span> <span class="kw">noheader</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>-----------------------------------------------------------------------------------
        satisfied | Odds ratio   Std. err.      z    P&gt;|z|     [95% conf. interval]
------------------+----------------------------------------------------------------
         eduyrs01 |   .9581206   .0657619    -0.62   0.533     .8375231    1.096083
           agea01 |   .0638744   .0145077   -12.11   0.000     .0409256    .0996917
         attend01 |   1.716344   .0821872    11.28   0.000     1.562588    1.885229
         health01 |   10.51119   .6168301    40.09   0.000     9.369164    11.79243
            inc01 |   3.687235   .1497774    32.12   0.000     3.405058    3.992796
                  |
c.agea01#c.agea01 |   131.4471   36.36336    17.64   0.000     76.43205    226.0613
                  |
            gni01 |   20.23763   8.670951     7.02   0.000     8.738895    46.86653
            _cons |   .0415953   .0072158   -18.33   0.000      .029606    .0584397
------------------+----------------------------------------------------------------
country           |
        var(_cons)|   .2759901   .0737762                      .1634386    .4660498
-----------------------------------------------------------------------------------
Note: Estimates are transformed only in the first equation to odds ratios.
Note: _cons estimates baseline odds (conditional on zero random effects).
LR test vs. logistic model: chibar2(01) = 1908.71     Prob &gt;= chibar2 = 0.0000</code></pre>
</div>
</div>
</section>
<section id="visualization" class="slide level2">
<h2>Visualization</h2>
<div class="cell" data-execution_count="66">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> margins, <span class="fu">at</span>(agea01 = (0(.1)1) <span class="co">/// define the lines</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>                inc01 = (0 1))    <span class="co">/// define the groups for which you will draw lines</span></span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>                nose              <span class="co">//  no standard errors (faster)</span></span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a>marginsplot, <span class="bn">title</span>(<span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Variables that uniquely identify margins: agea01 inc01</code></pre>
</div>

</div>
<img data-src="slides_files/figure-revealjs/cell-67-output-2.svg" class="r-stretch"></section>
<section id="cre-logit-model" class="slide level2">
<h2>CRE logit model</h2>
<div class="cell" data-execution_count="67">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>melogit satisfied eduyrs01-inc01 c.agea01#c.agea01 <span class="co">/// L1</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>  m_* gni01 || country:, <span class="kw">nolog</span> <span class="kw">noheader</span>            <span class="co">// L2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>-----------------------------------------------------------------------------------
        satisfied | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]
------------------+----------------------------------------------------------------
         eduyrs01 |   -.045561   .0686728    -0.66   0.507    -.1801573    .0890353
           agea01 |    -2.7527   .2271467   -12.12   0.000    -3.197899   -2.307501
         attend01 |   .5412893   .0479316    11.29   0.000     .4473451    .6352334
         health01 |   2.349852   .0587044    40.03   0.000     2.234794    2.464911
            inc01 |    1.30561   .0406408    32.13   0.000     1.225956    1.385265
                  |
c.agea01#c.agea01 |   4.879777   .2766528    17.64   0.000     4.337547    5.422006
                  |
       m_eduyrs01 |   1.182299   1.861753     0.64   0.525    -2.466669    4.831268
         m_agea01 |   -4.74156   3.506955    -1.35   0.176    -11.61507    2.131946
       m_attend01 |  -1.574268   1.056028    -1.49   0.136    -3.644046    .4955094
       m_health01 |   4.600604   1.955448     2.35   0.019     .7679966    8.433212
          m_inc01 |   .8551229    1.41406     0.60   0.545    -1.916384    3.626629
            gni01 |   1.925604   .5838091     3.30   0.001     .7813594    3.069849
            _cons |  -4.931446   2.190266    -2.25   0.024    -9.224287    -.638604
------------------+----------------------------------------------------------------
country           |
        var(_cons)|   .1990187   .0533168                      .1177221    .3364571
-----------------------------------------------------------------------------------
LR test vs. logistic model: chibar2(01) = 1561.54     Prob &gt;= chibar2 = 0.0000</code></pre>
</div>
</div>
</section>
<section id="summary-1" class="slide level2">
<h2>Summary</h2>
<ul>
<li>With a few minor differences, mixed-effects logit is similar to mixed-effects linear models.</li>
<li>The differences that exist are primarily about the differences between linear regression and logistic regression rather than anything having to do with multilevel models.</li>
<li>If you understand logistic regression well, you’ll have little trouble extending it to the multilevel case.</li>
</ul>
</section></section>
<section>
<section id="presenting-results" class="title-slide slide level1 center">
<h1>Presenting results</h1>

</section>
<section id="presentation-conventions" class="slide level2">
<h2>Presentation conventions</h2>
<ol type="1">
<li>Null model</li>
<li>Variables measured at L1</li>
<li>Variables measured at L2</li>
<li>Cross-level interactions (often most interesting part!)</li>
<li>Plot interactions</li>
</ol>
</section>
<section id="section-5" class="slide level2">
<h2></h2>
<p><img data-src="images/Hook.png" height="600"></p>

<aside><div>
<p>Hook. 2006. “<a href="https://journals.sagepub.com/doi/10.1177/000312240607100406">Care in Context: Men’s Unpaid Work in 20 Countries, 1965–2003.</a>” <em>American Sociological Review.</em></p>
</div></aside></section>
<section id="section-6" class="slide level2">
<h2></h2>

<img data-src="images/Hook2.png" style="width:100.0%" class="r-stretch"></section>
<section id="additional-resources" class="slide level2">
<h2>Additional resources</h2>
<ul>
<li><a href="https://www.google.com/books/edition/Multilevel_Modeling_in_Plain_Language/WfyICwAAQBAJ"><em>Multilevel Modeling in Plain Language</em></a>, Robson and Pevalin</li>
<li><a href="https://www.google.com/books/edition/Fixed_Effects_Regression_Models/3UxaBQAAQBAJ?kptab=getbook"><em>Fixed Effects Regression Models</em></a>, Allison</li>
<li><a href="https://www.google.com/books/edition/Multilevel_and_Longitudinal_Modeling_Usi/TM-3zgEACAAJ"><em>Multilevel and Longitudinal Modeling Using Stata</em></a> (4th ed.), Rabe-Hesketh and Skrondal</li>
</ul>
<div class="footer footer-default">

</div>
</section></section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="slides_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="slides_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="slides_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="slides_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="slides_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="slides_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="slides_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="slides_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="slides_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="slides_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'smaller': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        target: function(trigger) {
          return trigger.previousElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn) {
        const config = {
          allowHTML: true,
          content: contentFn,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto-reveal',
          placement: 'bottom-start'
        };
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>